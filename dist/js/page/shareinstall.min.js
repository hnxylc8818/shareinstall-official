ShareInstall=function(win,doc,xhr){function ReadyObj(){this.arr=[],this.run=function(e){this.arr?this.arr[this.arr.length]=e:e()},this.isReady=function(){return null==this.arr},this.ready=function(){if(null!=this.arr)for(var e=0;e<this.arr.length;e++)this.arr[e]();this.arr=null}}function parseObj(e){var n=[];for(var t in e){var r=e[t];if("[object Array]"==Object.prototype.toString.call(r))for(var a=0;a<r.length;a++)null!=r[a]&&void 0!==r[a]&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(r[a]));else null!=r&&void 0!==r&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}return n.join("&")}function myAjax(e){var n=new xhr,t=e.data,r=e.url,a=e.method;t&&"string"!=typeof t&&(t=MyJSON.stringify(t)),"POST"!=a&&t&&(r=r+(r.indexOf("?")>-1?"&":"?")+t,t=null),n.onreadystatechange=function(){if(n.readyState==("number"==typeof xhr.DONE?xhr.DONE:4)){if(200==n.status){var t=n.response||n.responseText||{};e.success&&e.success("string"==typeof t?MyJSON.parse(t):t)}else e.error&&e.error(n,n.statusText);e.complete&&e.complete(n)}},n.open(a,r,!0),n.ontimeout=function(){e.error&&e.error(n,n.statusText)},n.timeout=e.timeout||0,n.setRequestHeader&&n.setRequestHeader("Content-Type","application/json;charset=utf-8"),n.withCredentials=(e.xhrFields||{}).withCredentials,n.send(t)}function getContext(){var e=doc.createElement("canvas");if(e&&"function"==typeof e.getContext)for(var n=["webgl","webgl2","experimental-webgl2","experimental-webgl"],t=0;t<n.length;t++){var r=n[t],a=e.getContext(r);if(a){var i={};i.context=r,i.version=a.getParameter(a.VERSION),i.vendor=a.getParameter(a.VENDOR),i.sl_version=a.getParameter(a.SHADING_LANGUAGE_VERSION),i.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);var o=a.getExtension("WEBGL_debug_renderer_info");return o&&(i.vendor=a.getParameter(o.UNMASKED_VENDOR_WEBGL),i.renderer=a.getParameter(o.UNMASKED_RENDERER_WEBGL)),i}}return{}}function MyShareInstall(e,n){function t(e,n){var t=!1,r=navigator.userAgent.toLowerCase();r.indexOf("qq")>0&&r.indexOf("micromessenger")<0&&r.indexOf("android")>-1&&(t=!0);var a,i;t?(a="hidden",i="qbrowserVisibilityChange"):void 0!==doc.hidden?(a="hidden",i="visibilitychange"):void 0!==doc.msHidden?(a="msHidden",i="msvisibilitychange"):void 0!==doc.webkitHidden&&(a="webkitHidden",i="webkitvisibilitychange");var o=function(e){return t&&e&&void 0!==e.hidden?e.hidden:doc[a]},l=setTimeout(function(){null==l||o()||(e(),l=null)},n);i&&doc.addEventListener(i,function(e){null!=l&&o(e)&&(clearTimeout(l),l=null)},!1)}function r(e,n,r,a){"function"==typeof r&&t(r,a),C[e](n)}function a(e){var n=doc.createElement("div");return n.innerHTML=e,n=n.children[0],n.onclick=function(){doc.body.removeChild(n)},n}function i(e){var n="",t="",r=navigator.userAgent.toLowerCase();try{n=e.match(/\,([^\"]*)\"/)[1]||""}catch(e){}return t=MyJSON.parse(decode2(n)),t.shareInstallCode={appkey:g,timestamp:(+new Date).toString().slice(0,10)},r.indexOf("android")>0?e='<a value="'+encode2(MyJSON.stringify(t))+'">&nbsp;</a>':e.replace(n,encode2(MyJSON.stringify(t)))}function o(e,n,t){e=i(e);if("function"!=typeof doc.execCommand)return!1;var r=doc.createElement("div");r.innerHTML=e;for(var a=[],o=0;o<r.children.length;o++)a[o]=r.children[o];for(var l,c,d=!1,s=n?n+((new Date).getTime()+1e3*(t||1))+"-":null,o=0;o<a.length;o++)try{if(l=a[o],doc.body.appendChild(l),"SELECT"===l.nodeName)l.focus();else if("INPUT"===l.nodeName||"TEXTAREA"===l.nodeName){s&&(l.value=encode2(decode2(l.value)+s));var f=l.hasAttribute("readonly");f||l.setAttribute("readonly",""),l.select(),l.setSelectionRange(0,l.value.length),f||l.removeAttribute("readonly")}else{l.hasAttribute("contenteditable")&&l.focus(),s&&l.setAttribute("class",s),c=win.getSelection();var u=doc.createRange();u.selectNode(l),c.removeAllRanges(),c.addRange(u)}d=doc.execCommand("copy"),doc.body.removeChild(l)}catch(e){doc.body.removeChild(l),d=!1}return c&&c.removeAllRanges(),d}function l(){var n=navigator.userAgent.toLowerCase();f.apkUrl&&"function"==typeof e.apkDownloadHandler?e.apkDownloadHandler(f.apkUrl):(f.fallbackUrl&&u||n.indexOf("android")>-1)&&((n.indexOf("micromessenger")>0||n.indexOf("qq")>0)&&n.indexOf("android")>-1?(f.fallbackUrl?C[f.schemaMethod](f.fallbackUrl):n.indexOf("micromessenger")>0&&doc.body.appendChild(u),n.indexOf("qq")>0&&n.indexOf("micromessenger")<0&&!f.fallbackUrl&&MyShareInstall.getAPK()):n.indexOf("android")>-1&&!f.fallbackUrl?MyShareInstall.getAPK():C[f.fallbackMethod](f.fallbackUrl))}function c(e,n,t){docReady(function(){w.run(function(){var a=navigator.userAgent.toLowerCase(),i=a.indexOf("iphone")>-1?"ios":a.indexOf("android")>-1?"android":"",c=n?l:null,d="";if(e||"android"==f.platform&&"qq"!=f.brower&&"chrome25"!=f.brower&&"samsung"==f.brower&&(e=!0),f.pb&&n&&o(f.pb,f.ypp,parseInt(f.yps||"0")),f.schemaUrl&&e){"ios"===i&&f.schemaUrl.indexOf("https://")>-1&&(f.fallbackUrl.indexOf("https://itunes.apple.com")<0&&(f.fallbackUrl="http://api.shareinstall.com/plists/page?app_key="+g),d="?url="+f.fallbackUrl,f.schemaUrl.indexOf(d)<0&&(f.schemaUrl=f.schemaUrl+d));var s=(t||{}).timeout||f.wt||1500;(a.indexOf("iphone")>-1||a.indexOf("ipad")>-1||a.indexOf("ipod")>-1)&&a.indexOf("micromessenger")>0&&(doc.body.appendChild(u),f.schemaMethod="frm"),(a.indexOf("iphone")>-1||a.indexOf("ipad")>-1||a.indexOf("ipod")>-1)&&(c=null),r(f.schemaMethod,f.schemaUrl,c,s)}else c&&c()})})}function d(n,t){var r=navigator.userAgent.toLowerCase();O&&(clearTimeout(O),O=null),n=n||{},n.v||(n.v=VERSION);var i=encode1(MyJSON.stringify(n)),o=MyJSON.parse(MyJSON.stringify(n));o.cus=t,window._SHAREINSTALLCODE=encode1(MyJSON.stringify(o));var l="";for(var c in n)l+=c+":"+n[c];myAjax({url:MyShareInstall.server+"/shareinstall/wap.h?code="+i,method:"POST",xhrFields:{withCredentials:!0},data:t,success:function(i){1==i.status?(f={},f.fallbackUrl="https://www.shareinstall.com/error.html",f.schemaUrl="https://www.shareinstall.com/error.html",f.fallbackMethod="frm",f.schemaMethod="loc"):f=s(i.data[0]||{}),(r.indexOf("micromessenger")>0||r.indexOf("qq")>0)&&f.applied&&(f.fallbackUrl=f.applied,f.schemaUrl=""),i.shadow=e.shadow||i.shadow||"<div id='ShareInstallDom' style='font-size:30px;color:#fff;text-align:right;position:fixed;left:0;top:0;background:rgba(0,0,0,0.5);filter:alpha(opacity=50);width:100%;height:100%;z-index:10000;'>点击右上角在浏览器中打开</div>",i.shadow&&(u=a(i.shadow)),w.ready(),f.ttl&&(O=setTimeout(function(){d(n,t)},1e3*f.ttl))}})}function s(e){var n={sm:"schemaMethod",st:"schemaTimeout",fm:"fallbackMethod",au:"apkUrl",acl:"allowClickLog",p:"pb"};for(var t in e){var r=n[t];r&&(e[r]=e[t],delete e[t])}return e}e=e||{};var f,u,h,p,m,v,y=e.channelCode,g=e.appKey||"",b=e.onready,w=new ReadyObj,x=this;if(!y){var S=/[\?\&]channelCode=([^=&]+)/.exec(win.location.href);S&&(y=S[1])}"function"==typeof b&&w.run(function(){b.call(x)});try{h=win.screen.width||"",p=win.screen.height||"",v=win.devicePixelRatio===parseInt(win.devicePixelRatio)?parseFloat(win.devicePixelRatio).toFixed(1)||"":parseFloat(win.devicePixelRatio).toString()||"",m=getContext()}catch(e){}var O,C={frm:function(e){var n=doc.createElement("iframe");n.style.display="none",n.style.visibility="hidden",n.src=e,doc.body.appendChild(n)},loc:function(e){win.location=e},hrf:function(e){var n=doc.createElement("a");n.style.display="none",n.href=e,doc.body.appendChild(n),n.click()},inhrf:function(e){var n=doc.createElement("script");n.setAttribute("type","text/javascript"),n.innerHTML='(function(){var a = document.createElement("a");a.style.display = "none";a.href = "'+e.replace(/"/g,'\\"')+'";document.body.appendChild(a);a.click();})()',doc.body.appendChild(n)},open:function(e){win.open(e)}};this.wakeupOrInstall=function(e){MyShareInstall.logAjax(),c(!0,!0,e)},this.schemeWakeup=function(e){c(!0,!1,e)},this.install=function(e){c(!1,!0,e)},e.buttonId&&docReady(function(){for(var n=e.buttonId.split(" "),t=0;t<n.length;t++){var r=doc.getElementById(n[t]);r&&r.addEventListener("click",function(){x.wakeupOrInstall()})}}),init(function(t){var t=t||[],r=(t.length,navigator.userAgent.toLowerCase()),a=r.indexOf("iphone")>-1||r.indexOf("ipad")>-1||r.indexOf("ipod")>-1?"ios":r.indexOf("android")>-1?"android":"";if("ios"===a)var i=r.match(/os (.*?) like mac os/)[1].replace(/_/g,".");else if("android"===a)var i=r.match(/android\s([0-9\.]*)/)[1];else var i="";window.logData="sw="+(h||0)+"&sh="+(p||0)+"&sp="+v+"&gv="+(m.version||"")+"&gr="+(m.renderer||"")+"&li="+(t.length?t.join("-"):"")+"&os="+a+"&osver="+i+"&appkey="+g+"&v="+VERSION+"&cpp=jssdk&cp="+JSON.stringify(n),d({channelCode:y||"",sw:h.toString()||"0",sh:p.toString()||"0",sp:v,gv:m.version.replace(/\s/g,"")||"",gr:m.renderer.replace(/\s/g,"")||"",li:t.length?t.join("-"):"",c:1,apk:e.apkFileName||"",pw:e.preferWakeup?1:0,os:a,osver:i,appkey:g},n)})}var VERSION="1.0.3",b64=function(){function e(e){var n,t,r,i,o=-1,l=e.length,c=[0,0,0,0];for(n=[];++o<l;)t=e[o],r=e[++o],c[0]=t>>2,c[1]=(3&t)<<4|(r||0)>>4,o>=l?c[2]=c[3]=64:(i=e[++o],c[2]=(15&r)<<2|(i||0)>>6,c[3]=o>=l?64:63&i),n.push(a.charAt(c[0]),a.charAt(c[1]),a.charAt(c[2]),a.charAt(c[3]));return n.join("")}function n(e){for(var n,t,r,i,o,l,c,d=[],s=0;s<e.length;)i=a.indexOf(e.charAt(s++)),o=a.indexOf(e.charAt(s++)),l=a.indexOf(e.charAt(s++)),c=a.indexOf(e.charAt(s++)),n=i<<2|o>>4,t=(15&o)<<4|l>>2,r=(3&l)<<6|c,d.push(n),64!=l&&d.push(t),64!=c&&d.push(r);return d}function t(e){var n,t=-1,r=e.length,a=[];if(/^[\x00-\x7f]*$/.test(e))for(;++t<r;)a.push(e.charCodeAt(t));else for(;++t<r;)n=e.charCodeAt(t),128>n?a.push(n):2048>n?a.push(63&n|128):a.push(n>>12|224,n>>6&63|128,63&n|128);return a}function r(e){for(var n=0,t=0,r=0,a=[],i=0;i<e.length;)n=e[i],n<128?(a.push(String.fromCharCode(n)),i++):n>191&&n<224?(t=e[i+1],a.push(String.fromCharCode((31&n)<<6|63&t)),i+=2):(t=e[i+1],r=e[i+2],a.push(String.fromCharCode((15&n)<<12|(63&t)<<6|63&r)),i+=3);return a.join("")}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";return[function(n){if(!n)return"";for(var r=t(n),a=r.length,i=0;a>i;i++)r[i]=150^r[i];return e(r)},function(e){if(!e)return"";for(var t=n(e),a=0,i=t.length;i>a;a++)t[a]=150^t[a];return r(t)},function(n){return n?e(t(n)):""},function(e){return e?r(n(e)):""}]}(),encode1=b64[0],decode1=b64[1],encode2=b64[2],decode2=b64[3],docReady=function(){"use strict";function e(){if(!r){r=!0;for(var e=0;e<t.length;e++)t[e].fn.call(win,t[e].ctx);t=[]}}function n(){"complete"===doc.readyState&&e()}var t=[],r=!1,a=!1;return function(i,o){r?i(o):(t.push({fn:i,ctx:o}),"complete"===doc.readyState||!doc.attachEvent&&"interactive"===doc.readyState?e():a||(doc.addEventListener?(doc.addEventListener("DOMContentLoaded",e,!1),win.addEventListener("load",e,!1)):(doc.attachEvent("onreadystatechange",n),win.attachEvent("onload",e)),a=!0))}}(),init=function(){function e(){d.isReady()||(d.ready(),clearInterval(s),i&&i.close())}function n(){e()}function t(e){for(var n=e.split("."),t=0,r=0;r<n.length;r++)t=t<<8|255&parseInt(n[r]);return t}function r(n){for(var r,a,i,o,d=n.split("\r\n"),s=0;s<d.length;s++){if(r=d[s],a=r.split(" "),0==r.indexOf("a=candidate:")&&(i=a[7])&&"host"==i)o=a[4];else if(0==r.indexOf("a=rtcp:")&&(i=a[2])&&"IP4"==i)o=a[3];else if(0!=r.indexOf("c=")||!(i=a[1])||"IP4"!=i||!(o=a[2]))continue;o&&!l[o]&&/[0-9]{1,3}(\.[0-9]{1,3}){3}/.test(o)&&"0.0.0.0"!=o&&0!=o.indexOf("127.")&&3758096384!=(4026531840&t(o))&&(l[o]=1,c.push(o))}c.length&&e()}var a,i,o,l={},c=[],d=new ReadyObj,s=setInterval(function(){i&&i.localDescription&&i.localDescription.sdp&&o!=i.localDescription.sdp&&(o=i.localDescription.sdp,r(o))},10);try{a=win.RTCPeerConnection||win.mozRTCPeerConnection||win.webkitRTCPeerConnection,a?(i=new a({iceServers:[]},{optional:[{RtpDataChannels:!0}]}),i.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&r("a="+e.candidate.candidate)},i.createDataChannel("shareinstall"),i.createOffer(function(e){try{i.setLocalDescription(e,function(){},n)}catch(e){n()}},n),setTimeout(e,2e3)):n()}catch(e){n()}return function(e){d.run(function(){e(c)})}}(),MyJSON=win.JSON||{parse:function(str){return eval("("+str+")")},stringify:function(){var e=Object.prototype.toString,n=Array.isArray||function(n){return"[object Array]"===e.call(n)},t={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},r=function(e){return t[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)},a=/[\\"\u0000-\u001F\u2028\u2029]/g;return function t(i){if(null==i)return"null";if("number"==typeof i)return isFinite(i)?i.toString():"null";if("boolean"==typeof i)return i.toString();if("object"==typeof i){if("function"==typeof i.toJSON)return t(i.toJSON());if(n(i)){for(var o="[",l=0;l<i.length;l++)o+=(l?", ":"")+t(i[l]);return o+"]"}if("[object Object]"===e.call(i)){var c=[];for(var d in i)i.hasOwnProperty(d)&&c.push(t(d)+": "+t(i[d]));return"{"+c.sort().join(", ")+"}"}}return'"'+i.toString().replace(a,r)+'"'}}()};return MyShareInstall.channelRedirect=function(e,n){new MyShareInstall({appKey:e,channelCode:n,_channelRedirect:!0}).wakeupOrInstall()},MyShareInstall.parseUrlParams=function(){for(var e=(win.location.search||"?").substring(1).replace(/\+/g,"%20"),n=e.split("&"),t={},r=0;r<n.length;r++){var a=n[r].split("="),i=decodeURIComponent(a[0]||""),o=decodeURIComponent(a[1]||"");i&&o&&(void 0===t[i]?t[i]=o:"object"==typeof t[i]?t[i].push(o):t[i]=[t[i],o])}return t},MyShareInstall.setUid=function(){return+new Date+Math.random().toString(10).substring(2,6)},MyShareInstall.setCookie=function(e,n){var t=new Date;t.setTime(t.getTime()+2592e6),document.cookie=e+"="+encodeURI(n)+";expires="+t.toUTCString()+";path=/"},MyShareInstall.getCookie=function(e){var n,t=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(n=document.cookie.match(t))?decodeURI(n[2]):null},MyShareInstall.logAjax=function(){var e="";MyShareInstall.getCookie("ShareInstallUid")?e=MyShareInstall.getCookie("ShareInstallUid"):(e=MyShareInstall.setUid(),MyShareInstall.setCookie("ShareInstallUid",e));var n=document.createElement("script"),t="https://statlog.shareinstall.com/shareinstall_log/si?jsonpcallback=getRes&ordernumber="+e+"&";n.type="text/javascript",n.src=t+window.logData,document.body.appendChild(n)},MyShareInstall.getAPK=function(){var e=document.createElement("script"),n=document.createElement("script"),t=MyShareInstall.server+"/shareinstall/apk.h?jsonpcallback=getShareApk&code="+window._SHAREINSTALLCODE;e.type="text/javascript",e.src=t,n.type="text/javascript",n.innerHTML='function getShareApk(info) {var iframe = document.createElement("iframe");iframe.style.display = "none"; iframe.style.visibility = "hidden"; iframe.src = info.data[0]["fallbackUrl"]; document.body.appendChild(iframe);}',document.body.appendChild(n),document.body.appendChild(e)},window.getRes=function(e){},MyShareInstall.docReady=docReady,MyShareInstall.server="https://wapcollision.shareinstall.com",MyShareInstall}(window,document,XMLHttpRequest);