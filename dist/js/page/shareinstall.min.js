ShareInstall=function(win,doc,xhr){function ReadyObj(){this.arr=[],this.run=function(e){this.arr?this.arr[this.arr.length]=e:e()},this.isReady=function(){return null==this.arr},this.ready=function(){if(null!=this.arr)for(var e=0;e<this.arr.length;e++)this.arr[e]();this.arr=null}}function parseObj(e){var n=[];for(var t in e){var r=e[t];if("[object Array]"==Object.prototype.toString.call(r))for(var o=0;o<r.length;o++)null!=r[o]&&void 0!==r[o]&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(r[o]));else null!=r&&void 0!==r&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}return n.join("&")}function myAjax(e){var n=new xhr,t=e.data,r=e.url,o=e.method;t&&"string"!=typeof t&&(t=MyJSON.stringify(t)),"POST"!=o&&t&&(r=r+(r.indexOf("?")>-1?"&":"?")+t,t=null),n.onreadystatechange=function(){if(n.readyState==("number"==typeof xhr.DONE?xhr.DONE:4)){if(200==n.status){var t=n.response||n.responseText||{};e.success&&e.success("string"==typeof t?MyJSON.parse(t):t)}else e.error&&e.error(n,n.statusText);e.complete&&e.complete(n)}},n.open(o,r,!0),n.ontimeout=function(){e.error&&e.error(n,n.statusText)},n.timeout=e.timeout||0,n.setRequestHeader&&n.setRequestHeader("Content-Type","application/json;charset=utf-8"),n.withCredentials=(e.xhrFields||{}).withCredentials,n.send(t)}function getContext(){var e=doc.createElement("canvas");if(e&&"function"==typeof e.getContext)for(var n=["webgl","webgl2","experimental-webgl2","experimental-webgl"],t=0;t<n.length;t++){var r=n[t],o=e.getContext(r);if(o){var a={};a.context=r,a.version=o.getParameter(o.VERSION),a.vendor=o.getParameter(o.VENDOR),a.sl_version=o.getParameter(o.SHADING_LANGUAGE_VERSION),a.max_texture_size=o.getParameter(o.MAX_TEXTURE_SIZE);var i=o.getExtension("WEBGL_debug_renderer_info");return i&&(a.vendor=o.getParameter(i.UNMASKED_VENDOR_WEBGL),a.renderer=o.getParameter(i.UNMASKED_RENDERER_WEBGL)),a}}return{}}function MyShareInstall(e,n){function t(e,n){var t,r;void 0!==doc.hidden?(t="hidden",r="visibilitychange"):void 0!==doc.msHidden?(t="msHidden",r="msvisibilitychange"):void 0!==doc.webkitHidden&&(t="webkitHidden",r="webkitvisibilitychange");var o=function(e){return doc[t]},a=setTimeout(function(){null==a||o()||(e(),a=null)},n);r&&doc.addEventListener(r,function(e){null!=a&&o()&&(clearTimeout(a),a=null)},!1)}function r(e,n,r,o){"function"==typeof r&&t(r,o),O[e](n)}function o(e){var n=doc.createElement("div");return n.innerHTML=e,n=n.children[0],n.onclick=function(){doc.body.removeChild(n)},n}function a(e,n,t){if("function"!=typeof doc.execCommand)return!1;var r=doc.createElement("div");r.innerHTML=e;for(var o=[],a=0;a<r.children.length;a++)o[a]=r.children[a];for(var i,c,l=!1,s=n?n+((new Date).getTime()+1e3*(t||1))+"-":null,a=0;a<o.length;a++)try{if(i=o[a],doc.body.appendChild(i),"SELECT"===i.nodeName)i.focus();else if("INPUT"===i.nodeName||"TEXTAREA"===i.nodeName){s&&(i.value=encode2(decode2(i.value)+s));var d=i.hasAttribute("readonly");d||i.setAttribute("readonly",""),i.select(),i.setSelectionRange(0,i.value.length),d||i.removeAttribute("readonly")}else{i.hasAttribute("contenteditable")&&i.focus(),s&&i.setAttribute("class",s),c=win.getSelection();var u=doc.createRange();u.selectNode(i),c.removeAllRanges(),c.addRange(u)}l=doc.execCommand("copy"),doc.body.removeChild(i)}catch(e){doc.body.removeChild(i),l=!1}return c&&c.removeAllRanges(),l}function i(){var n=navigator.userAgent.toLowerCase();d.apkUrl&&"function"==typeof e.apkDownloadHandler?e.apkDownloadHandler(d.apkUrl):d.fallbackUrl&&u&&(n.indexOf("micromessenger")>0||n.indexOf("qq")>0?(doc.body.appendChild(u),O[d.schemaMethod](d.fallbackUrl)):O[d.fallbackMethod](d.fallbackUrl))}function c(e,n,t){docReady(function(){b.run(function(){var o=navigator.userAgent.toLowerCase(),c=o.indexOf("iphone")>-1?"ios":o.indexOf("android")>-1?"android":"",l=n?i:null;if(e||"android"==d.platform&&"qq"!=d.brower&&"chrome25"!=d.brower&&"samsung"==d.brower&&(e=!0),d.pb&&n&&a(d.pb,d.ypp,parseInt(d.yps||"0")),d.schemaUrl&&e){"ios"===c&&d.schemaUrl.indexOf("https://")>-1&&(d.fallbackUrl.indexOf("https://itunes.apple.com")<0&&(d.fallbackUrl="http://api.shareinstall.com/plists/page?app_key="+y),d.schemaUrl=d.schemaUrl+"?url="+d.fallbackUrl);var s=(t||{}).timeout||d.wt;r(d.schemaMethod,d.schemaUrl,l,s)}else l&&l()})})}function l(e,n){var t=navigator.userAgent.toLowerCase();C&&(clearTimeout(C),C=null),e=e||{},e.v||(e.v=VERSION);var r=encode1(MyJSON.stringify(e));console.log("options::\n",e),console.log("MyJSON.stringify(options)::\n",MyJSON.stringify(e)),console.log("paramCode::\n",r);var a="";for(var i in e)a+=i+":"+e[i];myAjax({url:MyShareInstall.server+"/shareinstall/wap.h?code="+r,method:"POST",xhrFields:{withCredentials:!0},data:n,success:function(r){console.log("res::",r),d=s(r.data[0]||{}),(t.indexOf("micromessenger")>0||t.indexOf("qq")>0)&&d.applied&&(d.fallbackUrl=d.applied,d.schemaUrl=""),console.log("res::",d),r.shadow=r.shadow||"<div style='font-size:0.5rem;color:#fff;text-align:center;position:fixed;left:0;top:0;background:rgba(0,0,0,0.5);filter:alpha(opacity=50);width:100%;height:100%;z-index:10000;'>点击右上角在浏览器中打开</div>",r.shadow&&(u=o(r.shadow)),b.ready(),d.ttl&&(C=setTimeout(function(){l(e,n)},1e3*d.ttl))}})}function s(e){var n={sm:"schemaMethod",st:"schemaTimeout",fm:"fallbackMethod",au:"apkUrl",acl:"allowClickLog",p:"pb"};for(var t in e){var r=n[t];r&&(e[r]=e[t],delete e[t])}return e}e=e||{};var d,u,f,h,p,v,g=e.channelCode,y=e.appKey||"",m=e.onready,b=new ReadyObj,w=this;if(!g){var x=/[\?\&]channelCode=([^=&]+)/.exec(win.location.href);x&&(g=x[1])}"function"==typeof m&&b.run(function(){m.call(w)});try{f=win.screen.width||"",h=win.screen.height||"",v=parseFloat(win.devicePixelRatio).toFixed(1)||"",p=getContext()}catch(e){}var C,O={frm:function(e){var n=doc.createElement("iframe");n.style.display="none",n.style.visibility="hidden",n.src=e,doc.body.appendChild(n)},loc:function(e){win.location=e},hrf:function(e){var n=doc.createElement("a");n.style.display="none",n.href=e,doc.body.appendChild(n),n.click()},inhrf:function(e){var n=doc.createElement("script");n.setAttribute("type","text/javascript"),n.innerHTML='(function(){var a = document.createElement("a");a.style.display = "none";a.href = "'+e.replace(/"/g,'\\"')+'";document.body.appendChild(a);a.click();})()',doc.body.appendChild(n)},open:function(e){win.open(e)}};this.wakeupOrInstall=function(e){MyShareInstall.logAjax(),c(!0,!0,e)},this.schemeWakeup=function(e){c(!0,!1,e)},this.install=function(e){c(!1,!0,e)},e.buttonId&&docReady(function(){for(var n=e.buttonId.split(" "),t=0;t<n.length;t++){var r=doc.getElementById(n[t]);r&&r.addEventListener("click",function(){w.wakeupOrInstall()})}}),init(function(t){var t=t||[],r=(t.length,navigator.userAgent.toLowerCase()),o=r.indexOf("iphone")>-1?"ios":r.indexOf("android")>-1?"android":"";if("ios"===o)var a=r.match(/cpu iphone os (.*?) like mac os/)[1].replace(/_/g,".");else if("android"===o)var a=r.match(/android\s([0-9\.]*)/)[1];else var a="";console.log("ipArr::",t),console.log("os::",o),console.log("osver::",a),console.log("appKey::",y),window.logData="sw="+(f||0)+"&sh="+(h||0)+"&sp="+v+"&gv="+(p.version||"")+"&gr="+(p.renderer||"")+"&li="+(t.length?t.join("-"):"")+"&os="+o+"&osver="+a+"&appkey="+y+"&v="+VERSION+"&cpp=jssdk&cp="+JSON.stringify(ShareInstall.parseUrlParams()),l({channelCode:g||"",sw:f||0,sh:h||0,sp:v,gv:p.version||"",gr:p.renderer||"",li:t.length?t.join("-"):"",c:1,apk:e.apkFileName||"",pw:e.preferWakeup?1:0,os:o,osver:a,appkey:y},n)})}var VERSION="1.0.1",b64=function(){function e(e){var n,t,r,a,i=-1,c=e.length,l=[0,0,0,0];for(n=[];++i<c;)t=e[i],r=e[++i],l[0]=t>>2,l[1]=(3&t)<<4|(r||0)>>4,i>=c?l[2]=l[3]=64:(a=e[++i],l[2]=(15&r)<<2|(a||0)>>6,l[3]=i>=c?64:63&a),n.push(o.charAt(l[0]),o.charAt(l[1]),o.charAt(l[2]),o.charAt(l[3]));return n.join("")}function n(e){for(var n,t,r,a,i,c,l,s=[],d=0;d<e.length;)a=o.indexOf(e.charAt(d++)),i=o.indexOf(e.charAt(d++)),c=o.indexOf(e.charAt(d++)),l=o.indexOf(e.charAt(d++)),n=a<<2|i>>4,t=(15&i)<<4|c>>2,r=(3&c)<<6|l,s.push(n),64!=c&&s.push(t),64!=l&&s.push(r);return s}function t(e){var n,t=-1,r=e.length,o=[];if(/^[\x00-\x7f]*$/.test(e))for(;++t<r;)o.push(e.charCodeAt(t));else for(;++t<r;)n=e.charCodeAt(t),128>n?o.push(n):2048>n?o.push(63&n|128):o.push(n>>12|224,n>>6&63|128,63&n|128);return o}function r(e){for(var n=0,t=0,r=0,o=[],a=0;a<e.length;)n=e[a],n<128?(o.push(String.fromCharCode(n)),a++):n>191&&n<224?(t=e[a+1],o.push(String.fromCharCode((31&n)<<6|63&t)),a+=2):(t=e[a+1],r=e[a+2],o.push(String.fromCharCode((15&n)<<12|(63&t)<<6|63&r)),a+=3);return o.join("")}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";return[function(n){if(!n)return"";for(var r=t(n),o=r.length,a=0;o>a;a++)r[a]=150^r[a];return e(r)},function(e){if(!e)return"";for(var t=n(e),o=0,a=t.length;a>o;o++)t[o]=150^t[o];return r(t)},function(n){return n?e(t(n)):""},function(e){return e?r(n(e)):""}]}(),encode1=b64[0],decode1=b64[1],encode2=b64[2],decode2=b64[3],docReady=function(){"use strict";function e(){if(!r){r=!0;for(var e=0;e<t.length;e++)t[e].fn.call(win,t[e].ctx);t=[]}}function n(){"complete"===doc.readyState&&e()}var t=[],r=!1,o=!1;return function(a,i){r?a(i):(t.push({fn:a,ctx:i}),"complete"===doc.readyState||!doc.attachEvent&&"interactive"===doc.readyState?e():o||(doc.addEventListener?(doc.addEventListener("DOMContentLoaded",e,!1),win.addEventListener("load",e,!1)):(doc.attachEvent("onreadystatechange",n),win.attachEvent("onload",e)),o=!0))}}(),init=function(){function e(){s.isReady()||(s.ready(),clearInterval(d),a&&a.close())}function n(){e()}function t(e){for(var n=e.split("."),t=0,r=0;r<n.length;r++)t=t<<8|255&parseInt(n[r]);return t}function r(n){for(var r,o,a,i,s=n.split("\r\n"),d=0;d<s.length;d++){if(r=s[d],o=r.split(" "),0==r.indexOf("a=candidate:")&&(a=o[7])&&"host"==a)i=o[4];else if(0==r.indexOf("a=rtcp:")&&(a=o[2])&&"IP4"==a)i=o[3];else if(0!=r.indexOf("c=")||!(a=o[1])||"IP4"!=a||!(i=o[2]))continue;i&&!c[i]&&/[0-9]{1,3}(\.[0-9]{1,3}){3}/.test(i)&&"0.0.0.0"!=i&&0!=i.indexOf("127.")&&3758096384!=(4026531840&t(i))&&(c[i]=1,l.push(i))}l.length&&e()}var o,a,i,c={},l=[],s=new ReadyObj,d=setInterval(function(){a&&a.localDescription&&a.localDescription.sdp&&i!=a.localDescription.sdp&&(i=a.localDescription.sdp,r(i))},10);try{o=win.RTCPeerConnection||win.mozRTCPeerConnection||win.webkitRTCPeerConnection,o?(a=new o({iceServers:[]},{optional:[{RtpDataChannels:!0}]}),a.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&r("a="+e.candidate.candidate)},a.createDataChannel("shareinstall"),a.createOffer(function(e){try{a.setLocalDescription(e,function(){},n)}catch(e){n()}},n),setTimeout(e,2e3)):n()}catch(e){n()}return function(e){s.run(function(){e(l)})}}(),MyJSON=win.JSON||{parse:function(str){return eval("("+str+")")},stringify:function(){var e=Object.prototype.toString,n=Array.isArray||function(n){return"[object Array]"===e.call(n)},t={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},r=function(e){return t[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)},o=/[\\"\u0000-\u001F\u2028\u2029]/g;return function t(a){if(null==a)return"null";if("number"==typeof a)return isFinite(a)?a.toString():"null";if("boolean"==typeof a)return a.toString();if("object"==typeof a){if("function"==typeof a.toJSON)return t(a.toJSON());if(n(a)){for(var i="[",c=0;c<a.length;c++)i+=(c?", ":"")+t(a[c]);return i+"]"}if("[object Object]"===e.call(a)){var l=[];for(var s in a)a.hasOwnProperty(s)&&l.push(t(s)+": "+t(a[s]));return"{"+l.sort().join(", ")+"}"}}return'"'+a.toString().replace(o,r)+'"'}}()};return MyShareInstall.channelRedirect=function(e,n){new MyShareInstall({appKey:e,channelCode:n,_channelRedirect:!0}).wakeupOrInstall()},MyShareInstall.parseUrlParams=function(){for(var e=(win.location.search||"?").substring(1).replace(/\+/g,"%20"),n=e.split("&"),t={},r=0;r<n.length;r++){var o=n[r].split("="),a=decodeURIComponent(o[0]||""),i=decodeURIComponent(o[1]||"");a&&i&&(void 0===t[a]?t[a]=i:"object"==typeof t[a]?t[a].push(i):t[a]=[t[a],i])}return t},MyShareInstall.logAjax=function(){var e=document.createElement("script"),n=document.createElement("script");e.type="text/javascript",e.src="https://statlog.shareinstall.com/shareinstall_log/si?jsonpcallback=getRes&"+window.logData,n.type="text/javascript",n.innerHTML="function getRes(info) {console.log(info)}",document.body.appendChild(n),document.body.appendChild(e)},MyShareInstall.docReady=docReady,MyShareInstall.server="https://collision.shareinstall.com",MyShareInstall}(window,document,XMLHttpRequest);