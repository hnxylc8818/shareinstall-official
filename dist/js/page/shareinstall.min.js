ShareInstall=function(win,doc,xhr){function ReadyObj(){this.arr=[],this.run=function(e){this.arr?this.arr[this.arr.length]=e:e()},this.isReady=function(){return null==this.arr},this.ready=function(){if(null!=this.arr)for(var e=0;e<this.arr.length;e++)this.arr[e]();this.arr=null}}function parseObj(e){var t=[];for(var n in e){var r=e[n];if("[object Array]"==Object.prototype.toString.call(r))for(var a=0;a<r.length;a++)null!=r[a]&&void 0!==r[a]&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(r[a]));else null!=r&&void 0!==r&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}return t.join("&")}function myAjax(e){var t=new xhr,n=e.data,r=e.url,a=e.method;n&&"string"!=typeof n&&(n=MyJSON.stringify(n)),"POST"!=a&&n&&(r=r+(r.indexOf("?")>-1?"&":"?")+n,n=null),t.onreadystatechange=function(){if(t.readyState==("number"==typeof xhr.DONE?xhr.DONE:4)){if(200==t.status){var n=t.response||t.responseText||{};e.success&&e.success("string"==typeof n?MyJSON.parse(n):n)}else e.error&&e.error(t,t.statusText);e.complete&&e.complete(t)}},t.open(a,r,!0),t.ontimeout=function(){e.error&&e.error(t,t.statusText)},t.timeout=e.timeout||0,t.setRequestHeader&&t.setRequestHeader("Content-Type","application/json;charset=utf-8"),t.withCredentials=(e.xhrFields||{}).withCredentials,t.send(n)}function getContext(){var e=doc.createElement("canvas");if(e&&"function"==typeof e.getContext)for(var t=["webgl","webgl2","experimental-webgl2","experimental-webgl"],n=0;n<t.length;n++){var r=t[n],a=e.getContext(r);if(a){var o={};o.context=r,o.version=a.getParameter(a.VERSION),o.vendor=a.getParameter(a.VENDOR),o.sl_version=a.getParameter(a.SHADING_LANGUAGE_VERSION),o.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);var i=a.getExtension("WEBGL_debug_renderer_info");return i&&(o.vendor=a.getParameter(i.UNMASKED_VENDOR_WEBGL),o.renderer=a.getParameter(i.UNMASKED_RENDERER_WEBGL)),o}}return{}}function MyShareInstall(e,t){function n(e,t){var n,r;void 0!==doc.hidden?(n="hidden",r="visibilitychange"):void 0!==doc.msHidden?(n="msHidden",r="msvisibilitychange"):void 0!==doc.webkitHidden&&(n="webkitHidden",r="webkitvisibilitychange");var a=function(e){return doc[n]},o=setTimeout(function(){null==o||a()||(e(),o=null)},t);r&&doc.addEventListener(r,function(e){null!=o&&a()&&(clearTimeout(o),o=null)},!1)}function r(e,t,r,a){"function"==typeof r&&n(r,a),C[e](t)}function a(e){var t=doc.createElement("div");return t.innerHTML=e,t=t.children[0],t.onclick=function(){doc.body.removeChild(t)},t}function o(e,t,n){navigator.userAgent.toLowerCase().indexOf("android")>0&&(e=e.match(/\,([^\"]*)\"/)[1]||"",e='<a value="'+e+'">&nbsp;</a>');if("function"!=typeof doc.execCommand)return!1;var r=doc.createElement("div");r.innerHTML=e;for(var a=[],o=0;o<r.children.length;o++)a[o]=r.children[o];for(var i,c,l=!1,d=t?t+((new Date).getTime()+1e3*(n||1))+"-":null,o=0;o<a.length;o++)try{if(i=a[o],doc.body.appendChild(i),"SELECT"===i.nodeName)i.focus();else if("INPUT"===i.nodeName||"TEXTAREA"===i.nodeName){d&&(i.value=encode2(decode2(i.value)+d));var s=i.hasAttribute("readonly");s||i.setAttribute("readonly",""),i.select(),i.setSelectionRange(0,i.value.length),s||i.removeAttribute("readonly")}else{i.hasAttribute("contenteditable")&&i.focus(),d&&i.setAttribute("class",d),c=win.getSelection();var u=doc.createRange();u.selectNode(i),c.removeAllRanges(),c.addRange(u)}l=doc.execCommand("copy"),doc.body.removeChild(i)}catch(e){doc.body.removeChild(i),l=!1}return c&&c.removeAllRanges(),l}function i(){var t=navigator.userAgent.toLowerCase();s.apkUrl&&"function"==typeof e.apkDownloadHandler?e.apkDownloadHandler(s.apkUrl):s.fallbackUrl&&u&&((t.indexOf("micromessenger")>0||t.indexOf("qq")>0)&&t.indexOf("android")>-1?(doc.body.appendChild(u),C[s.schemaMethod](s.fallbackUrl)):C[s.fallbackMethod](s.fallbackUrl))}function c(e,t,n){docReady(function(){b.run(function(){var a=navigator.userAgent.toLowerCase(),c=a.indexOf("iphone")>-1?"ios":a.indexOf("android")>-1?"android":"",l=t?i:null,d="";if(e||"android"==s.platform&&"qq"!=s.brower&&"chrome25"!=s.brower&&"samsung"==s.brower&&(e=!0),s.pb&&t&&o(s.pb,s.ypp,parseInt(s.yps||"0")),s.schemaUrl&&e){"ios"===c&&s.schemaUrl.indexOf("https://")>-1&&(s.fallbackUrl.indexOf("https://itunes.apple.com")<0&&(s.fallbackUrl="http://api.shareinstall.com/plists/page?app_key="+g),d="?url="+s.fallbackUrl,s.schemaUrl.indexOf(d)<0&&(s.schemaUrl=s.schemaUrl+d));var f=(n||{}).timeout||s.wt||1500;(a.indexOf("iphone")>-1||a.indexOf("ipad")>-1||a.indexOf("ipod")>-1)&&a.indexOf("micromessenger")>0&&doc.body.appendChild(u),r(s.schemaMethod,s.schemaUrl,l,f)}else l&&l()})})}function l(e,t){var n=navigator.userAgent.toLowerCase();O&&(clearTimeout(O),O=null),e=e||{},e.v||(e.v=VERSION);var r=encode1(MyJSON.stringify(e)),o="";for(var i in e)o+=i+":"+e[i];myAjax({url:MyShareInstall.server+"/shareinstall/wap.h?code="+r,method:"POST",xhrFields:{withCredentials:!0},data:t,success:function(r){1==r.status?(s={},s.fallbackUrl="https://www.shareinstall.com/error.html",s.schemaUrl="https://www.shareinstall.com/error.html",s.fallbackMethod="frm",s.schemaMethod="loc"):s=d(r.data[0]||{}),(n.indexOf("micromessenger")>0||n.indexOf("qq")>0)&&s.applied&&(s.fallbackUrl=s.applied,s.schemaUrl=""),r.shadow=r.shadow||"<div id='ShareInstallDom' style='font-size:30px;color:#fff;text-align:right;position:fixed;left:0;top:0;background:rgba(0,0,0,0.5);filter:alpha(opacity=50);width:100%;height:100%;z-index:10000;'>点击右上角在浏览器中打开</div>",r.shadow&&(u=a(r.shadow)),b.ready(),s.ttl&&(O=setTimeout(function(){l(e,t)},1e3*s.ttl))}})}function d(e){var t={sm:"schemaMethod",st:"schemaTimeout",fm:"fallbackMethod",au:"apkUrl",acl:"allowClickLog",p:"pb"};for(var n in e){var r=t[n];r&&(e[r]=e[n],delete e[n])}return e}e=e||{};var s,u,f,h,p,v,m=e.channelCode,g=e.appKey||"",y=e.onready,b=new ReadyObj,w=this;if(!m){var x=/[\?\&]channelCode=([^=&]+)/.exec(win.location.href);x&&(m=x[1])}"function"==typeof y&&b.run(function(){y.call(w)});try{f=win.screen.width||"",h=win.screen.height||"",v=parseFloat(win.devicePixelRatio).toFixed(1)||"",p=getContext()}catch(e){}var O,C={frm:function(e){var t=doc.createElement("iframe");t.style.display="none",t.style.visibility="hidden",t.src=e,doc.body.appendChild(t)},loc:function(e){win.location=e},hrf:function(e){var t=doc.createElement("a");t.style.display="none",t.href=e,doc.body.appendChild(t),t.click()},inhrf:function(e){var t=doc.createElement("script");t.setAttribute("type","text/javascript"),t.innerHTML='(function(){var a = document.createElement("a");a.style.display = "none";a.href = "'+e.replace(/"/g,'\\"')+'";document.body.appendChild(a);a.click();})()',doc.body.appendChild(t)},open:function(e){win.open(e)}};this.wakeupOrInstall=function(e){MyShareInstall.logAjax(),c(!0,!0,e)},this.schemeWakeup=function(e){c(!0,!1,e)},this.install=function(e){c(!1,!0,e)},e.buttonId&&docReady(function(){for(var t=e.buttonId.split(" "),n=0;n<t.length;n++){var r=doc.getElementById(t[n]);r&&r.addEventListener("click",function(){w.wakeupOrInstall()})}}),init(function(n){var n=n||[],r=(n.length,navigator.userAgent.toLowerCase()),a=r.indexOf("iphone")>-1?"ios":r.indexOf("android")>-1?"android":"";if("ios"===a)var o=r.match(/cpu iphone os (.*?) like mac os/)[1].replace(/_/g,".");else if("android"===a)var o=r.match(/android\s([0-9\.]*)/)[1];else var o="";window.logData="sw="+(f||0)+"&sh="+(h||0)+"&sp="+v+"&gv="+(p.version||"")+"&gr="+(p.renderer||"")+"&li="+(n.length?n.join("-"):"")+"&os="+a+"&osver="+o+"&appkey="+g+"&v="+VERSION+"&cpp=jssdk&cp="+JSON.stringify(ShareInstall.parseUrlParams()),l({channelCode:m||"",sw:f||0,sh:h||0,sp:v,gv:p.version||"",gr:p.renderer||"",li:n.length?n.join("-"):"",c:1,apk:e.apkFileName||"",pw:e.preferWakeup?1:0,os:a,osver:o,appkey:g},t)})}var VERSION="1.0.2",b64=function(){function e(e){var t,n,r,o,i=-1,c=e.length,l=[0,0,0,0];for(t=[];++i<c;)n=e[i],r=e[++i],l[0]=n>>2,l[1]=(3&n)<<4|(r||0)>>4,i>=c?l[2]=l[3]=64:(o=e[++i],l[2]=(15&r)<<2|(o||0)>>6,l[3]=i>=c?64:63&o),t.push(a.charAt(l[0]),a.charAt(l[1]),a.charAt(l[2]),a.charAt(l[3]));return t.join("")}function t(e){for(var t,n,r,o,i,c,l,d=[],s=0;s<e.length;)o=a.indexOf(e.charAt(s++)),i=a.indexOf(e.charAt(s++)),c=a.indexOf(e.charAt(s++)),l=a.indexOf(e.charAt(s++)),t=o<<2|i>>4,n=(15&i)<<4|c>>2,r=(3&c)<<6|l,d.push(t),64!=c&&d.push(n),64!=l&&d.push(r);return d}function n(e){var t,n=-1,r=e.length,a=[];if(/^[\x00-\x7f]*$/.test(e))for(;++n<r;)a.push(e.charCodeAt(n));else for(;++n<r;)t=e.charCodeAt(n),128>t?a.push(t):2048>t?a.push(63&t|128):a.push(t>>12|224,t>>6&63|128,63&t|128);return a}function r(e){for(var t=0,n=0,r=0,a=[],o=0;o<e.length;)t=e[o],t<128?(a.push(String.fromCharCode(t)),o++):t>191&&t<224?(n=e[o+1],a.push(String.fromCharCode((31&t)<<6|63&n)),o+=2):(n=e[o+1],r=e[o+2],a.push(String.fromCharCode((15&t)<<12|(63&n)<<6|63&r)),o+=3);return a.join("")}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";return[function(t){if(!t)return"";for(var r=n(t),a=r.length,o=0;a>o;o++)r[o]=150^r[o];return e(r)},function(e){if(!e)return"";for(var n=t(e),a=0,o=n.length;o>a;a++)n[a]=150^n[a];return r(n)},function(t){return t?e(n(t)):""},function(e){return e?r(t(e)):""}]}(),encode1=b64[0],decode1=b64[1],encode2=b64[2],decode2=b64[3],docReady=function(){"use strict";function e(){if(!r){r=!0;for(var e=0;e<n.length;e++)n[e].fn.call(win,n[e].ctx);n=[]}}function t(){"complete"===doc.readyState&&e()}var n=[],r=!1,a=!1;return function(o,i){r?o(i):(n.push({fn:o,ctx:i}),"complete"===doc.readyState||!doc.attachEvent&&"interactive"===doc.readyState?e():a||(doc.addEventListener?(doc.addEventListener("DOMContentLoaded",e,!1),win.addEventListener("load",e,!1)):(doc.attachEvent("onreadystatechange",t),win.attachEvent("onload",e)),a=!0))}}(),init=function(){function e(){d.isReady()||(d.ready(),clearInterval(s),o&&o.close())}function t(){e()}function n(e){for(var t=e.split("."),n=0,r=0;r<t.length;r++)n=n<<8|255&parseInt(t[r]);return n}function r(t){for(var r,a,o,i,d=t.split("\r\n"),s=0;s<d.length;s++){if(r=d[s],a=r.split(" "),0==r.indexOf("a=candidate:")&&(o=a[7])&&"host"==o)i=a[4];else if(0==r.indexOf("a=rtcp:")&&(o=a[2])&&"IP4"==o)i=a[3];else if(0!=r.indexOf("c=")||!(o=a[1])||"IP4"!=o||!(i=a[2]))continue;i&&!c[i]&&/[0-9]{1,3}(\.[0-9]{1,3}){3}/.test(i)&&"0.0.0.0"!=i&&0!=i.indexOf("127.")&&3758096384!=(4026531840&n(i))&&(c[i]=1,l.push(i))}l.length&&e()}var a,o,i,c={},l=[],d=new ReadyObj,s=setInterval(function(){o&&o.localDescription&&o.localDescription.sdp&&i!=o.localDescription.sdp&&(i=o.localDescription.sdp,r(i))},10);try{a=win.RTCPeerConnection||win.mozRTCPeerConnection||win.webkitRTCPeerConnection,a?(o=new a({iceServers:[]},{optional:[{RtpDataChannels:!0}]}),o.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&r("a="+e.candidate.candidate)},o.createDataChannel("shareinstall"),o.createOffer(function(e){try{o.setLocalDescription(e,function(){},t)}catch(e){t()}},t),setTimeout(e,2e3)):t()}catch(e){t()}return function(e){d.run(function(){e(l)})}}(),MyJSON=win.JSON||{parse:function(str){return eval("("+str+")")},stringify:function(){var e=Object.prototype.toString,t=Array.isArray||function(t){return"[object Array]"===e.call(t)},n={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},r=function(e){return n[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)},a=/[\\"\u0000-\u001F\u2028\u2029]/g;return function n(o){if(null==o)return"null";if("number"==typeof o)return isFinite(o)?o.toString():"null";if("boolean"==typeof o)return o.toString();if("object"==typeof o){if("function"==typeof o.toJSON)return n(o.toJSON());if(t(o)){for(var i="[",c=0;c<o.length;c++)i+=(c?", ":"")+n(o[c]);return i+"]"}if("[object Object]"===e.call(o)){var l=[];for(var d in o)o.hasOwnProperty(d)&&l.push(n(d)+": "+n(o[d]));return"{"+l.sort().join(", ")+"}"}}return'"'+o.toString().replace(a,r)+'"'}}()};return MyShareInstall.channelRedirect=function(e,t){new MyShareInstall({appKey:e,channelCode:t,_channelRedirect:!0}).wakeupOrInstall()},MyShareInstall.parseUrlParams=function(){for(var e=(win.location.search||"?").substring(1).replace(/\+/g,"%20"),t=e.split("&"),n={},r=0;r<t.length;r++){var a=t[r].split("="),o=decodeURIComponent(a[0]||""),i=decodeURIComponent(a[1]||"");o&&i&&(void 0===n[o]?n[o]=i:"object"==typeof n[o]?n[o].push(i):n[o]=[n[o],i])}return n},MyShareInstall.logAjax=function(){var e=document.createElement("script"),t=document.createElement("script");e.type="text/javascript",e.src="https://statlog.shareinstall.com/shareinstall_log/si?jsonpcallback=getRes&"+window.logData,t.type="text/javascript",t.innerHTML="function getRes(info) {console.log(info)}",document.body.appendChild(t),document.body.appendChild(e)},MyShareInstall.docReady=docReady,MyShareInstall.server="https://wapcollision.shareinstall.com",MyShareInstall}(window,document,XMLHttpRequest);