ShareInstall=function(win,doc,xhr){function ReadyObj(){this.arr=[],this.run=function(e){this.arr?this.arr[this.arr.length]=e:e()},this.isReady=function(){return null==this.arr},this.ready=function(){if(null!=this.arr)for(var e=0;e<this.arr.length;e++)this.arr[e]();this.arr=null}}function parseObj(e){var t=[];for(var n in e){var r=e[n];if("[object Array]"==Object.prototype.toString.call(r))for(var a=0;a<r.length;a++)null!=r[a]&&void 0!==r[a]&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(r[a]));else null!=r&&void 0!==r&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}return t.join("&")}function myAjax(e){var t=new xhr,n=e.data,r=e.url,a=e.method;n&&"string"!=typeof n&&(n=MyJSON.stringify(n)),"POST"!=a&&n&&(r=r+(r.indexOf("?")>-1?"&":"?")+n,n=null),t.onreadystatechange=function(){if(t.readyState==("number"==typeof xhr.DONE?xhr.DONE:4)){if(200==t.status){var n=t.response||t.responseText||{};e.success&&e.success("string"==typeof n?MyJSON.parse(n):n)}else e.error&&e.error(t,t.statusText);e.complete&&e.complete(t)}},t.open(a,r,!0),t.ontimeout=function(){e.error&&e.error(t,t.statusText)},t.timeout=e.timeout||0,t.setRequestHeader&&t.setRequestHeader("Content-Type","application/json;charset=utf-8"),t.withCredentials=(e.xhrFields||{}).withCredentials,t.send(n)}function httpAjax(e){e=e||{};var t=e.type||"GET";t=t.toUpperCase()||"GET";var n=e.url||"",r=e.async||!0,a=e.data||null,i=e.success||function(){},o=e.fail||function(){},l=null;l=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var c=[];for(var s in a)c.push(s+"="+a[s]);var d=c.join("&");"POST"===t?(l.open(t,n,r),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),l.send(d)):(l.open(t,n+"?"+d,r),l.send(null)),l.onreadystatechange=function(){if(4==l.readyState){var e=l.status;e>=200&&e<300?i&&i(l.responseText):o&&o(e)}}}function getContext(){var e=doc.createElement("canvas");if(e&&"function"==typeof e.getContext)for(var t=["webgl","webgl2","experimental-webgl2","experimental-webgl"],n=0;n<t.length;n++){var r=t[n],a=e.getContext(r);if(a){var i={};i.context=r,i.version=a.getParameter(a.VERSION),i.vendor=a.getParameter(a.VENDOR),i.sl_version=a.getParameter(a.SHADING_LANGUAGE_VERSION),i.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);var o=a.getExtension("WEBGL_debug_renderer_info");return o&&(i.vendor=a.getParameter(o.UNMASKED_VENDOR_WEBGL),i.renderer=a.getParameter(o.UNMASKED_RENDERER_WEBGL)),i}}return{}}function MyShareInstall(e,t){function n(e,t){var n=!1,r=navigator.userAgent.toLowerCase();r.indexOf("qq")>0&&r.indexOf("micromessenger")<0&&r.indexOf("android")>-1&&(n=!0);var a,i;n?(a="hidden",i="qbrowserVisibilityChange"):void 0!==doc.hidden?(a="hidden",i="visibilitychange"):void 0!==doc.msHidden?(a="msHidden",i="msvisibilitychange"):void 0!==doc.webkitHidden&&(a="webkitHidden",i="webkitvisibilitychange");var o=function(e){return n&&e&&void 0!==e.hidden?e.hidden:doc[a]},l=setTimeout(function(){null==l||o()||(e(),l=null)},t);i&&doc.addEventListener(i,function(e){null!=l&&o(e)&&(clearTimeout(l),l=null)},!1)}function r(e,t,r,a){"function"==typeof r&&n(r,a),C[e](t)}function a(e){var t=doc.createElement("div");return t.innerHTML=e,t=t.children[0],t.onclick=function(){doc.body.removeChild(t)},t}function i(e){var t="",n="",r=navigator.userAgent.toLowerCase();try{t=e.match(/\,([^\"]*)\"/)[1]||""}catch(e){}return n=MyJSON.parse(decode2(t)),n.shareInstallCode={appkey:y,timestamp:(+new Date).toString().slice(0,10)},r.indexOf("android")>0?e='<a value="'+encode2(MyJSON.stringify(n))+'">&nbsp;</a>':e.replace(t,encode2(MyJSON.stringify(n)))}function o(e,t,n){e=i(e);if("function"!=typeof doc.execCommand)return!1;var r=doc.createElement("div");r.innerHTML=e;for(var a=[],o=0;o<r.children.length;o++)a[o]=r.children[o];for(var l,c,s=!1,d=t?t+((new Date).getTime()+1e3*(n||1))+"-":null,o=0;o<a.length;o++)try{if(l=a[o],doc.body.appendChild(l),"SELECT"===l.nodeName)l.focus();else if("INPUT"===l.nodeName||"TEXTAREA"===l.nodeName){d&&(l.value=encode2(decode2(l.value)+d));var u=l.hasAttribute("readonly");u||l.setAttribute("readonly",""),l.select(),l.setSelectionRange(0,l.value.length),u||l.removeAttribute("readonly")}else{l.hasAttribute("contenteditable")&&l.focus(),d&&l.setAttribute("class",d),c=win.getSelection();var f=doc.createRange();f.selectNode(l),c.removeAllRanges(),c.addRange(f)}s=doc.execCommand("copy"),doc.body.removeChild(l)}catch(e){doc.body.removeChild(l),s=!1}return c&&c.removeAllRanges(),s}function l(){var t=navigator.userAgent.toLowerCase();u.apkUrl&&"function"==typeof e.apkDownloadHandler?e.apkDownloadHandler(u.apkUrl):(u.fallbackUrl&&f||t.indexOf("android")>-1)&&((t.indexOf("micromessenger")>0||t.indexOf("qq")>0)&&t.indexOf("android")>-1?(u.fallbackUrl?C[u.schemaMethod](u.fallbackUrl):t.indexOf("micromessenger")>0&&doc.body.appendChild(f),t.indexOf("qq")>0&&t.indexOf("micromessenger")<0&&!u.fallbackUrl&&MyShareInstall.getAPK()):t.indexOf("android")>-1&&!u.fallbackUrl?MyShareInstall.getAPK():C[u.fallbackMethod](u.fallbackUrl))}function c(e,t,n){docReady(function(){b.run(function(){var a=navigator.userAgent.toLowerCase(),i=a.indexOf("iphone")>-1?"ios":a.indexOf("android")>-1?"android":"",c=t?l:null,s="";if(e||"android"==u.platform&&"qq"!=u.brower&&"chrome25"!=u.brower&&"samsung"==u.brower&&(e=!0),u.pb&&t&&o(u.pb,u.ypp,parseInt(u.yps||"0")),u.schemaUrl&&e){"ios"===i&&u.schemaUrl.indexOf("https://")>-1&&(u.fallbackUrl.indexOf("https://itunes.apple.com")<0&&(u.fallbackUrl="http://api.shareinstall.com/plists/page?app_key="+y),s="?url="+u.fallbackUrl,u.schemaUrl.indexOf(s)<0&&(u.schemaUrl=u.schemaUrl+s));var d=(n||{}).timeout||u.wt||0;(a.indexOf("iphone")>-1||a.indexOf("ipad")>-1||a.indexOf("ipod")>-1)&&a.indexOf("micromessenger")>0&&(doc.body.appendChild(f),u.schemaMethod="frm"),(a.indexOf("iphone")>-1||a.indexOf("ipad")>-1||a.indexOf("ipod")>-1)&&(c=null),r(u.schemaMethod,u.schemaUrl,c,d)}else c&&c()})})}function s(t,n){var r=navigator.userAgent.toLowerCase();S&&(clearTimeout(S),S=null),t=t||{},t.v||(t.v=VERSION);var i=encode1(MyJSON.stringify(t)),o=MyJSON.parse(MyJSON.stringify(t));o.cus=n,window._SHAREINSTALLCODE=encode1(MyJSON.stringify(o));var l="";for(var c in t)l+=c+":"+t[c];myAjax({url:MyShareInstall.server+"/shareinstall/wap.h?code="+i,method:"POST",xhrFields:{withCredentials:!0},data:n,success:function(i){1==i.status?(u={},u.fallbackUrl="https://www.shareinstall.com/error.html",u.schemaUrl="https://www.shareinstall.com/error.html",u.fallbackMethod="frm",u.schemaMethod="loc"):u=d(i.data[0]||{}),(r.indexOf("micromessenger")>0||r.indexOf("qq")>0)&&u.applied&&(u.fallbackUrl=u.applied,u.schemaUrl=""),i.shadow=e.shadow||i.shadow||"<div id='ShareInstallDom' style='font-size:30px;color:#fff;text-align:right;position:fixed;left:0;top:0;background:rgba(0,0,0,0.5);filter:alpha(opacity=50);width:100%;height:100%;z-index:10000;'><img src='http://imgmini.eastday.com/shareinstall/admin/assets/1530617476_tip-icon.png' alt='' style='width:60%;margin-top:20px;'></div>",i.shadow&&(f=a(i.shadow)),b.ready(),u.ttl&&(S=setTimeout(function(){s(t,n)},1e3*u.ttl))}})}function d(e){var t={sm:"schemaMethod",st:"schemaTimeout",fm:"fallbackMethod",au:"apkUrl",acl:"allowClickLog",p:"pb"};for(var n in e){var r=t[n];r&&(e[r]=e[n],delete e[n])}return e}e=e||{};var u,f,h,p,m,v,g=e.channelCode,y=e.appKey||"",w=e.onready,b=new ReadyObj,x=this;if(!g){var O=/[\?\&]channelCode=([^=&]+)/.exec(win.location.href);O&&(g=O[1])}"function"==typeof w&&b.run(function(){w.call(x)});try{h=win.screen.width||"",p=win.screen.height||"",v=win.devicePixelRatio===parseInt(win.devicePixelRatio)?parseFloat(win.devicePixelRatio).toFixed(1)||"":parseFloat(win.devicePixelRatio).toString()||"",m=getContext()}catch(e){}var S,C={frm:function(e){var t=doc.createElement("iframe");t.style.display="none",t.style.visibility="hidden",t.src=e,doc.body.appendChild(t)},loc:function(e){win.location=e},hrf:function(e){var t=doc.createElement("a");t.style.display="none",t.href=e,doc.body.appendChild(t),t.click()},inhrf:function(e){var t=doc.createElement("script");t.setAttribute("type","text/javascript"),t.innerHTML='(function(){var a = document.createElement("a");a.style.display = "none";a.href = "'+e.replace(/"/g,'\\"')+'";document.body.appendChild(a);a.click();})()',doc.body.appendChild(t)},open:function(e){win.open(e)}};this.wakeupOrInstall=function(e){MyShareInstall.logAjax(c,e)},this.schemeWakeup=function(e){c(!0,!1,e)},this.install=function(e){c(!1,!0,e)},e.buttonId&&docReady(function(){for(var t=e.buttonId.split(" "),n=0;n<t.length;n++){var r=doc.getElementById(t[n]);r&&r.addEventListener("click",function(){x.wakeupOrInstall()})}}),init(function(n){var n=n||[],r=(n.length,navigator.userAgent.toLowerCase()),a=r.indexOf("iphone")>-1||r.indexOf("ipad")>-1||r.indexOf("ipod")>-1?"ios":r.indexOf("android")>-1?"android":"";if("ios"===a)var i=r.match(/os (.*?) like mac os/)[1].replace(/_/g,".");else if("android"===a)var i=r.match(/android\s([0-9\.]*)/)[1];else var i="";window.logData="sw="+(h||0)+"&sh="+(p||0)+"&sp="+v+"&gv="+(m.version||"")+"&gr="+(m.renderer||"")+"&li="+(n.length?n.join("-"):"")+"&os="+a+"&osver="+i+"&appkey="+y+"&v="+VERSION+"&cpp=jssdk&cp="+JSON.stringify(t),s({channelCode:g||"",sw:h.toString()||"0",sh:p.toString()||"0",sp:v,gv:m.version?m.version.replace(/\s/g,""):"",gr:m.renderer?m.renderer.replace(/\s/g,""):"",li:n.length?n.join("-"):"",c:1,apk:e.apkFileName||"",pw:e.preferWakeup?1:0,os:a,osver:i,appkey:y},t)})}var VERSION="1.0.6",b64=function(){function e(e){var t,n,r,i,o=-1,l=e.length,c=[0,0,0,0];for(t=[];++o<l;)n=e[o],r=e[++o],c[0]=n>>2,c[1]=(3&n)<<4|(r||0)>>4,o>=l?c[2]=c[3]=64:(i=e[++o],c[2]=(15&r)<<2|(i||0)>>6,c[3]=o>=l?64:63&i),t.push(a.charAt(c[0]),a.charAt(c[1]),a.charAt(c[2]),a.charAt(c[3]));return t.join("")}function t(e){for(var t,n,r,i,o,l,c,s=[],d=0;d<e.length;)i=a.indexOf(e.charAt(d++)),o=a.indexOf(e.charAt(d++)),l=a.indexOf(e.charAt(d++)),c=a.indexOf(e.charAt(d++)),t=i<<2|o>>4,n=(15&o)<<4|l>>2,r=(3&l)<<6|c,s.push(t),64!=l&&s.push(n),64!=c&&s.push(r);return s}function n(e){var t,n=-1,r=e.length,a=[];if(/^[\x00-\x7f]*$/.test(e))for(;++n<r;)a.push(e.charCodeAt(n));else for(;++n<r;)t=e.charCodeAt(n),128>t?a.push(t):2048>t?a.push(63&t|128):a.push(t>>12|224,t>>6&63|128,63&t|128);return a}function r(e){for(var t=0,n=0,r=0,a=[],i=0;i<e.length;)t=e[i],t<128?(a.push(String.fromCharCode(t)),i++):t>191&&t<224?(n=e[i+1],a.push(String.fromCharCode((31&t)<<6|63&n)),i+=2):(n=e[i+1],r=e[i+2],a.push(String.fromCharCode((15&t)<<12|(63&n)<<6|63&r)),i+=3);return a.join("")}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";return[function(t){if(!t)return"";for(var r=n(t),a=r.length,i=0;a>i;i++)r[i]=150^r[i];return e(r)},function(e){if(!e)return"";for(var n=t(e),a=0,i=n.length;i>a;a++)n[a]=150^n[a];return r(n)},function(t){return t?e(n(t)):""},function(e){return e?r(t(e)):""}]}(),encode1=b64[0],decode1=b64[1],encode2=b64[2],decode2=b64[3],docReady=function(){function e(){if(!r){r=!0;for(var e=0;e<n.length;e++)n[e].fn.call(win,n[e].ctx);n=[]}}function t(){"complete"===doc.readyState&&e()}var n=[],r=!1,a=!1;return function(i,o){r?i(o):(n.push({fn:i,ctx:o}),"complete"===doc.readyState||!doc.attachEvent&&"interactive"===doc.readyState?e():a||(doc.addEventListener?(doc.addEventListener("DOMContentLoaded",e,!1),win.addEventListener("load",e,!1)):(doc.attachEvent("onreadystatechange",t),win.attachEvent("onload",e)),a=!0))}}(),init=function(){function e(){s.isReady()||(s.ready(),clearInterval(d),i&&i.close())}function t(){e()}function n(e){for(var t=e.split("."),n=0,r=0;r<t.length;r++)n=n<<8|255&parseInt(t[r]);return n}function r(t){for(var r,a,i,o,s=t.split("\r\n"),d=0;d<s.length;d++){if(r=s[d],a=r.split(" "),0==r.indexOf("a=candidate:")&&(i=a[7])&&"host"==i)o=a[4];else if(0==r.indexOf("a=rtcp:")&&(i=a[2])&&"IP4"==i)o=a[3];else if(0!=r.indexOf("c=")||!(i=a[1])||"IP4"!=i||!(o=a[2]))continue;o&&!l[o]&&/[0-9]{1,3}(\.[0-9]{1,3}){3}/.test(o)&&"0.0.0.0"!=o&&0!=o.indexOf("127.")&&3758096384!=(4026531840&n(o))&&(l[o]=1,c.push(o))}c.length&&e()}var a,i,o,l={},c=[],s=new ReadyObj,d=setInterval(function(){i&&i.localDescription&&i.localDescription.sdp&&o!=i.localDescription.sdp&&(o=i.localDescription.sdp,r(o))},10);try{a=win.RTCPeerConnection||win.mozRTCPeerConnection||win.webkitRTCPeerConnection,a?(i=new a({iceServers:[]},{optional:[{RtpDataChannels:!0}]}),i.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&r("a="+e.candidate.candidate)},i.createDataChannel("shareinstall"),i.createOffer(function(e){try{i.setLocalDescription(e,function(){},t)}catch(e){t()}},t),setTimeout(e,2e3)):t()}catch(e){t()}return function(e){s.run(function(){e(c)})}}(),MyJSON=win.JSON||{parse:function(str){return eval("("+str+")")},stringify:function(){var e=Object.prototype.toString,t=Array.isArray||function(t){return"[object Array]"===e.call(t)},n={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},r=function(e){return n[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)},a=/[\\"\u0000-\u001F\u2028\u2029]/g;return function n(i){if(null==i)return"null";if("number"==typeof i)return isFinite(i)?i.toString():"null";if("boolean"==typeof i)return i.toString();if("object"==typeof i){if("function"==typeof i.toJSON)return n(i.toJSON());if(t(i)){for(var o="[",l=0;l<i.length;l++)o+=(l?", ":"")+n(i[l]);return o+"]"}if("[object Object]"===e.call(i)){var c=[];for(var s in i)i.hasOwnProperty(s)&&c.push(n(s)+": "+n(i[s]));return"{"+c.sort().join(", ")+"}"}}return'"'+i.toString().replace(a,r)+'"'}}()};return MyShareInstall.channelRedirect=function(e,t){new MyShareInstall({appKey:e,channelCode:t,_channelRedirect:!0}).wakeupOrInstall()},MyShareInstall.parseUrlParams=function(){for(var e=(win.location.search||"?").substring(1).replace(/\+/g,"%20"),t=e.split("&"),n={},r=0;r<t.length;r++){var a=t[r].split("="),i=decodeURIComponent(a[0]||""),o=decodeURIComponent(a[1]||"");i&&o&&(void 0===n[i]?n[i]=o:"object"==typeof n[i]?n[i].push(o):n[i]=[n[i],o])}return n},MyShareInstall.setUid=function(){return+new Date+Math.random().toString(10).substring(2,6)},MyShareInstall.setCookie=function(e,t){var n=new Date;n.setTime(n.getTime()+2592e6),document.cookie=e+"="+encodeURI(t)+";expires="+n.toUTCString()+";path=/"},MyShareInstall.getCookie=function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?decodeURI(t[2]):null},MyShareInstall.url2json=function(e){for(var t,n=e.substring(e.indexOf("?")+1,e.length).split("&"),r={},a=0;t=n[a];a++){var i=t.substring(0,t.indexOf("=")).toLowerCase(),o=t.substring(t.indexOf("=")+1,t.length);o.indexOf("#")>-1&&(o=o.split("#")[0]),r[i]=o}return r},MyShareInstall.logAjax=function(e,t){var n="";MyShareInstall.getCookie("ShareInstallUid")?n=MyShareInstall.getCookie("ShareInstallUid"):(n=MyShareInstall.setUid(),MyShareInstall.setCookie("ShareInstallUid",n));var r="https://statlog.shareinstall.com/shareinstall_log/si?ordernumber="+n+"&"+window.logData;httpAjax({url:"https://statlog.shareinstall.com/shareinstall_log/si",type:"POST",data:MyShareInstall.url2json(r),async:!1,success:function(){e(!0,!0,t)},fail:function(){e(!0,!0,t)}})},MyShareInstall.getAPK=function(){var e=document.createElement("script"),t=document.createElement("script"),n=MyShareInstall.server+"/shareinstall/apk.h?jsonpcallback=getShareApk&code="+window._SHAREINSTALLCODE;e.type="text/javascript",e.src=n,t.type="text/javascript",t.innerHTML='function getShareApk(info) {var iframe = document.createElement("iframe");iframe.style.display = "none"; iframe.style.visibility = "hidden"; iframe.src = info.data[0]["fallbackUrl"]; document.body.appendChild(iframe);}',document.body.appendChild(t),document.body.appendChild(e)},MyShareInstall.docReady=docReady,MyShareInstall.server="https://wapcollision.shareinstall.com",MyShareInstall}(window,document,XMLHttpRequest);