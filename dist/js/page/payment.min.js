var DfttModule=function(e){var t={name:"Index",typed:null,order_id:"",init:function(){var e=this;e.url="http://api.shareinstall.com/",e.getAppInfo(),e.cancelFun(),e.countPrice(),e.clickToPay(),e.verifyStatement()},countPrice:function(){var e=[3e3,5e3,7e3,1e4];$(document).on("click",".price-list li",function(){var t=e[$(this).index()];$(this).addClass("selected").siblings("li").removeClass("selected"),$("#appPrice").html(t+"元")})},cancelFun:function(){$("body").on("click",".cancel",function(){window.location.href="./application.html"})},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(t);return null!=a?decodeURIComponent(a[2]):null},timetrans:function(e){return e=new Date(1e3*e),e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},getAppInfo:function(){var e=this;$.ajax({url:e.url+"/appliance/getone",data:{app_key:$.cookie("appkey")},type:"POST",success:function(t){t.code=parseInt(t.code),0===t.code&&($("#appKey").text(t.data.app_key),$("#appTime").text(e.timetrans(t.data.createTime)),$("#appName").text(t.data.name),$("#xmTanImg").attr("src",t.data.icon),$.cookie("appName",t.data.name,{expires:7}),1===t.data.status?$("#appStatus").text("免费体验中"):2===t.data.status?$("#appStatus").text("已支付"):$("#appStatus").text("已过期"),$("#appOver").text(t.data.app_over_time))}})},clickToPay:function(){var e=this;$(document).on("click",".pay-code",function(){var t={},a={1:3e3,2:5e3,3:7e3,5:1e4};t.username=$.cookie("userName"),t.token=$.cookie("_token"),t.app_key=$.cookie("appkey"),t.count=parseInt($(".price-list").find(".selected").text()),t.price=a[t.count];var n=window.open();e.getOrderId(t,function(a){0==a.code?(t.order_id=a.data.order_id,$.cookie("orderid",a.data.order_id,{expires:7}),e.purchaseOrder(t,n)):88==a.code?(n.close(),layer.msg("登录已过期，请重新登录"),setTimeout(function(){window.location.href="./login.html"},3e3)):(n.close(),layer.msg(a.message))})})},getOrderId:function(e,t){return $.ajax({type:"POST",url:this.url+"/pay/createorder",data:e,success:function(e){t(e)}})},purchaseOrder:function(e,t){t.location=this.url+"/pay/purchase?username="+e.username+"&token="+e.token+"&order_id="+e.order_id},verifyStatement:function(){var e=this;$(".preservation").on("click",function(){$.ajax({type:"POST",url:e.url+"/pay/verifyorder",data:{username:$.cookie("userName"),token:$.cookie("_token"),app_key:$.cookie("appkey"),order_id:$.cookie("orderid")},success:function(e){0==e.code?(layer.msg("支付成功"),$.cookie("orderid",null),window.location.href="./application.html"):layer.msg("未支付,请完成支付")}})})}};return e[t.name]=t,e}(DfttModule||{});