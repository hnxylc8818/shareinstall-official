var DfttModule=function(t){var e={name:"Overview",typed:null,baseUrl:"http://tongji.021.com/datacenterapi/",init:function(){var t=this;t.appkey=this.getQueryString("appkey"),t.appkey||alert("appKey错误!"),t.getAmountStatistics(),t.amountStatistics(),t.growthTrendStatistics(),t.increaseStatistics(),t.valuePicker()},getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(e);return null!=a?decodeURIComponent(a[2]):null},writeAppkey:function(){var t=$.cookie("appkey");t&&"null"!==t&&$("#app_key").text(t)},drawAppicon:function(){var t=$.cookie("img");t&&"null"!==t&&$("#app_icon").attr("src",t)},writeAppName:function(){var t=$.cookie("appName");t&&$("#app_name").text(t)},getAppInfo:function(){var t=this;$.ajax({url:"http://api.shareinstall.com/appliance/getone",data:{app_key:$.cookie("appkey")},type:"POST",success:function(e){var a=e.data.app_over_time.replace(/-/g,"/"),n=parseInt(new Date(a)-new Date)/1e3/60/60/24;e.code=parseInt(e.code),0===e.code&&(0==e.data.status?t.pageInit():n<=10&&2==e.data.status&&t.pageInit(n))}})},pageInit:function(t){var e=$("#paymentInfo"),a=0;t&&(e.find(".pop-status").text("还有"+Math.round(t)+"天服务将过期"),a=1),a&&!$.cookie("warnshow"+$.cookie("appkey"))?($.cookie("warnshow"+$.cookie("appkey"),1,{expires:1}),layer.open({title:"到期提醒",type:1,area:"800",content:e,closeBtn:a})):a||layer.open({title:"到期提醒",type:1,area:"800",content:e,closeBtn:a})},gotoLink:function(){var t=this.getQueryString("key"),e=this.getQueryString("icon");$("#my-android").on("click",function(){window.location.href="./android.html?key="+t+"&icon="+e})},ajaxGet:function(t,e,a,n){e.appkey=this.appkey,e.channel="",$.ajax({type:"get",url:this.baseUrl+t,data:e,dataType:"jsonp",jsonp:"callbackparam",success:function(t){a(t)},error:function(t){n(t)}})},valuePicker:function(t){var e=this;$(document).on("click",function(t){0===$(t.target).parents(".data_profile").length&&$(".data_profile_ul").hide()}),$(".plantform_cur").on("click",function(){$(this).siblings(".data_profile_ul").toggle()}),$(".date-container").on("click",function(t){"date-value"!==t.target.className&&$(this).find(".date-value").click()}),$(document).on("click",".overlay-btn",function(){var t=$(this).siblings(".time").find(".date-value"),a=t.attr("date-value")?t.attr("date-value").split(","):"undefined",n="all",i=!1,r=0;$(this).parents(".title").find(".data_profile li").each(function(t,e){$(e).hasClass("active")&&(n=$(e).attr("data-value"))}),$(this).parents(".title").siblings(".contentER, .btnBox").find('[data-name="type"]').each(function(t,e){$(e).hasClass("active")&&(r=$(e).attr("data-value"))}),$(this).hasClass("active")?$(this).removeClass("active").attr("data-value","false"):($(this).addClass("active").attr("data-value","true"),i=!0),e.getAmountStatistics(a,t,i,n,r)}),$(document).on("click",".data_profile li",function(){var t=$(this).parents(".title").find(".date-value"),a=t.attr("date-value")?t.attr("date-value").split(","):"undefined",n=$(this).attr("data-value"),i=$(this).parents(".title").find(".overlay-btn").attr("data-value"),r=0;$(this).parents(".data_profile_ul").hide(),$(this).parents(".data_profile_ul").siblings(".plantform_cur").find("span").text(n),$(this).parents(".title").siblings(".contentER, .btnBox").find('[data-name="type"]').each(function(t,e){$(e).hasClass("active")&&(r=$(e).attr("data-value"))}),$(this).addClass("active").siblings("li").removeClass("active"),e.getAmountStatistics(a,t,i,n,r)}),$(document).on("click",'[data-name="type"]',function(){var t=$(this).parents(".btnBox, .contentER").siblings(".title").find(".date-value"),a=t.attr("date-value")?t.attr("date-value").split(","):"undefined",n="all",i=$(this).attr("data-value"),r=$(this).parents(".btnBox, .contentER").siblings(".title").find(".overlay-btn").attr("data-value");$(this).parents(".btnBox, .contentER").siblings(".title").find(".data_profile li").each(function(t,e){$(e).hasClass("active")&&(n=$(e).attr("data-value"))}),$(this).addClass("active").siblings().removeClass("active"),e.getAmountStatistics(a,t,r,n,i)})},initTime:function(t,e){var a=this,n={maxDate:moment(),dateLimit:{days:30},showDropdowns:!1,showWeekNumbers:!1,timePicker:!1,timePickerIncrement:60,timePicker12Hour:!1,ranges:{"所有":[moment("20160101","YYYYMMDD"),moment()],"今日":[moment().startOf("day"),moment()],"昨日":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7日":[moment().subtract("days",6),moment()],"最近30日":[moment().subtract("days",29),moment()]},opens:"left",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary blue",cancelClass:"btn-small",format:"YYYY/MM/DD",separator:" to ",locale:{applyLabel:"确定",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1}};if(e){var i=i||"最近七日";n.startDate=moment().subtract("days",6),n.endDate=moment(),t.attr("date-value",[moment().subtract("days",6).format("YYYYMMDD"),moment().format("YYYYMMDD")])}else var i=i||"今日";t.html(i),t.daterangepicker(n,function(e,n,i){var i="自定义"==i?e.format("YYYY/MM/DD")+" - "+n.format("YYYY/MM/DD"):i;t.html(i);var r=[e.format("YYYYMMDD"),n.format("YYYYMMDD")];t.attr("date-value",r);var o=t.parents("time").siblings("overlay-btn").attr("data-value"),s="all";t.parents(".title").find(".data_profile li").each(function(t,e){$(e).hasClass("active")&&(s=$(e).attr("data-value"))});var l=0;t.parents(".title").siblings(".contentER, .btnBox").find('[data-name="type"]').each(function(t,e){$(e).hasClass("active")&&(l=$(e).attr("data-value"))}),a.getAmountStatistics(r,t,o,s,l)})},initEchartsPie:function(t,e,a){var n=echarts.init(document.getElementById(t)),i={backgroundColor:"#fff",title:{x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},calculable:!0,series:[{name:e,type:"pie",radius:[20,50],color:["#00a3fe","#45dbda"],center:["50%","50%"],label:{normal:{show:!0},emphasis:{show:!0}},itemStyle:{normal:{borderWidth:2,borderColor:"#fff",label:{show:!1},labelLine:{show:!0,length:.001}}},data:a}]};n.setOption(i),window.addEventListener("resize",function(){setTimeout(function(){n.resize()},500)})},initEchartsCategory:function(t,e,a,n){var i=echarts.init(document.getElementById(t)),r={tooltip:{trigger:"axis"},legend:{data:[{name:"安装量",icon:"bar"},{name:"注册量",icon:"bar"},"安装量","注册量"]},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:{type:"value",axisTick:{inside:!0},scale:!0,axisLabel:{margin:2,formatter:function(t,e){return t>=1e4&&t<1e7?t=t/1e4+"万":t>=1e7&&(t=t/1e7+"千万"),t}}},series:[{name:"安装量",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{color:"#62c1fb"},color:"#62c1fb",borderColor:"#62c1fb"}},lineStyle:{normal:{color:"#62c1fb"}},data:a},{name:"注册量",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{color:"#21e8ee"}}},lineStyle:{normal:{width:3,color:"#21e8ee"}},data:n}],color:["#4ad8dc","#2492e7"]};i.setOption(r),window.addEventListener("resize",function(){setTimeout(function(){i.resize()},500)})},initEchartsCategoryActive:function(t,e,a,n){var i,r=echarts.init(document.getElementById(t));0!=n&&n?1==n?i={tooltip:{trigger:"axis"},legend:{data:[{name:"平均打开次数",icon:"bar"}]},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:[{type:"value"}],series:[{name:"平均打开次数",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{color:"#62c1fb"},color:"#62c1fb",borderColor:"#62c1fb"}},lineStyle:{normal:{color:"#62c1fb"}},data:a.actRate}],color:["#4ad8dc"]}:2==n&&(i={tooltip:{trigger:"axis"},legend:{data:[{name:"平均在线时长",icon:"bar"}]},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:[{type:"value"}],series:[{name:"平均在线时长",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{color:"#62c1fb"},color:"#62c1fb",borderColor:"#62c1fb"}},lineStyle:{normal:{color:"#62c1fb"}},data:a.actTime}],color:["#4ad8dc"]}):i={tooltip:{trigger:"axis"},legend:{data:[{name:"活跃设备数",icon:"bar"},{name:"活跃用户数",icon:"bar"},"活跃设备数","活跃用户数"]},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:{type:"value",axisTick:{inside:!0},scale:!0,axisLabel:{margin:2,formatter:function(t,e){return t>=1e4&&t<1e7?t=t/1e4+"万":t>=1e7&&(t=t/1e7+"千万"),t}}},series:[{name:"活跃设备数",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{color:"#62c1fb"},color:"#62c1fb",borderColor:"#62c1fb"}},lineStyle:{normal:{color:"#62c1fb"}},data:a.actUv},{name:"活跃用户数",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{color:"#21e8ee"}}},lineStyle:{normal:{width:3,color:"#21e8ee"}},data:a.registerAct}],color:["#4ad8dc","#2492e7"]},r.setOption(i),window.addEventListener("resize",function(){setTimeout(function(){r.resize()},500)})},initEchartsMap:function(t,e,a){var n=echarts.init(document.getElementById(t)),i={title:{x:"center"},tooltip:{trigger:"item",show:!0,formatter:function(t){var e=t.data.value?t.data.value:0;return t.data.name+":"+e},backgroundColor:"#000"},dataRange:{min:0,max:2500,x:"left",y:"bottom",text:["高","低"],calculable:!0},roamController:{show:!0,x:"right",mapTypeControl:{china:!0}},series:[{name:"ip",type:"map",mapType:"china",roam:!1,itemStyle:{normal:{label:{show:!1},textStyle:{backgroundColor:"#000"}},emphasis:{areaStyle:{color:"#000",backgroundColor:"blue"},label:{show:!0,color:"#000",textStyle:{}}}},data:e}]};1==a&&(i.tooltip.show=!1),n.setOption(i),window.addEventListener("resize",function(){setTimeout(function(){n.resize()},500)})},initEchartsInstallRegister:function(t,e){var a=this,n={startDate:t[0],endDate:t[1],appkey:"K6BKB62B7BHABH",exclude:e,platform:"all"};this.ajaxGet("shareinstallgatherdata/shareinstallgather",n,function(t){if(200===t.code){var e=t.datalist[0],n=0,i=0,r=0,o=0,s=0,l=0;e&&(n=e.register_total,i=e.install_total,r=e.register_ios,s=e.install_ios,o=e.register_android,l=e.install_android),$(".register").html(n),$(".install").html(i);var c=[{value:s,name:"ios"},{value:l,name:"Android"}],d=[{value:r,name:"ios"},{value:o,name:"Android"}];a.initEchartsPie("J_install","安装量",c),a.initEchartsPie("J_register","注册量",d)}})},growthTrend:function(t,e,a){var n=this,i={startDate:t[0],endDate:t[1],appkey:"K6BKB62B7BHABH",exclude:e,platform:a},r=[],o=[],s=[];this.ajaxGet("shareinstallgatherdata/shareinstallgrowgather",i,function(e){if(200===e.code){var a=e.datalist;a.length>0&&$.each(a,function(e,a){o.push(a.install_num),s.push(a.register_num),t[0]===t[1]?r.push(a.time):r.push(a.dt)}),n.initEchartsCategory("J_trend",r,o,s)}})},amountStatistics:function(){var t=this,e=$("#total");t.initTime(e)},getAmountStatistics:function(t,e,a,n,i){var r=this;if(void 0==t||"undefined"==t){t=[(new Date).getFullYear()+""+((new Date).getMonth()+1>9?(new Date).getMonth()+1:"0"+((new Date).getMonth()+1))+((new Date).getDate()>9?(new Date).getDate():"0"+(new Date).getDate()),(new Date).getFullYear()+""+((new Date).getMonth()+1>9?(new Date).getMonth()+1:"0"+((new Date).getMonth()+1))+((new Date).getDate()>9?(new Date).getDate():"0"+(new Date).getDate())]}if(void 0==a&&(a=!1),void 0==e)r.initEchartsInstallRegister(t,a),r.growthTrend(t,a,n),r.increaseTrend([moment().subtract("days",6).format("YYYYMMDD"),moment().format("YYYYMMDD")],a,n,i),r.ipTrend(t,a,n,i),r.getSystemVersion(t,a,n,i),r.getModel(t,a,n,i);else{var o=e.attr("id");"total"==o?r.initEchartsInstallRegister(t,a):"trend"==o?r.growthTrend(t,a,n):"increase"==o?r.increaseTrend(t,a,n,i):"ipspread"==o?r.ipTrend(t,a,n,i):"sys"==o?r.getSystemVersion(t,a,n):"branddevice"==o&&r.getModel(t,a,n,i)}},growthTrendStatistics:function(){var t=this,e=$("#trend");t.initTime(e)},increaseStatistics:function(){var t=this,e=$("#increase");t.initTime(e,!0)},increaseTrend:function(t,e,a,n){var i=this,r={startDate:t[0],endDate:t[1],appkey:"K6BKB62B7BHABH",platform:a,type:n},o={},s=[];o.actUv=[],o.registerAct=[],o.actTime=[],o.actRate=[],this.ajaxGet("shareinstallgatherdata/shareinstallactivegather",r,function(e){if(200===e.code){var a=e.datalist;a.length>0&&$.each(a,function(e,a){o.actUv.push(a.act_uv),o.registerAct.push(a.register_act),o.actTime.push(a.act_time),o.actRate.push(a.act_rate),"1"===n||"2"===n?s.push(a.dt):t[0]===t[1]?s.push(a.hh):s.push(a.dt)}),i.initEchartsCategoryActive("J_increase",s,o,n)}})},ipTrend:function(t,e,a,n){var i=this,r="J_ipMap",o={startDate:moment().subtract("days",1).startOf("day").format("YYYYMMDD"),endDate:moment().subtract("days",1).endOf("day").format("YYYYMMDD"),appkey:"K6BKB62B7BHABH",exclude:e,platform:a,type:n},s=[];this.ajaxGet("shareinstallgatherdata/shareinstallipspreadgather",o,function(t){if(200===t.code){var e=t.datalist;e.length>0&&$.each(e,function(t,e){1==n?(e.name=e.cityname,e.value=parseInt(e.cnt)):(e.name=e.provname,e.value=parseInt(e.cnt)),s.push(e)}),1==n?i.initEchartsMap(r,[],n):i.initEchartsMap(r,s),i.ipTrendRendering(s)}})},ipTrendRendering:function(t){var e="";if(t.length>0){for(var a=0;a<t.length;a++){t[a].name&&(e+="<div><span>"+t[a].name+"</span>：<span>"+t[a].value+"</span></div>")}$(".location_city").html(e)}else $(".location_city").html('<img src="./img/overview/none.png" alt="没有数据" class="" style="width: 48px; height: 68px; position: absolute; top: 50%; left: 50%; margin-left: -34px; margin-top: -34px;">')},getSystemVersion:function(t,e,a,n){var i=this,r={startDate:moment().subtract("days",1).startOf("day").format("YYYYMMDD"),endDate:moment().subtract("days",1).endOf("day").format("YYYYMMDD"),appkey:"K6BKB62B7BHABH",exclude:e,platform:a||"android"},o=[];this.ajaxGet("shareinstallgatherdata/shareinstallsysvergather",r,function(t){if(200===t.code){var e=t.datalist;e.length>0?($(".none-sysver").hide(),$.each(e,function(t,e){e.name=e.osver,e.value=parseInt(e.cnt),o.push(e)})):$(".none-sysver").show(),i.SystemVersionPie("J_systemVersion",o)}})},getModel:function(t,e,a,n){var i=this,r={startDate:moment().subtract("days",1).startOf("day").format("YYYYMMDD"),endDate:moment().subtract("days",1).endOf("day").format("YYYYMMDD"),appkey:"K6BKB62B7BHABH",exclude:e,platform:a||"android"},o=[];this.ajaxGet("shareinstallgatherdata/shareinstallbranddevicegather",r,function(t){if(200===t.code){var e=t.datalist;e.length>0?($(".none-device").hide(),$.each(e,function(t,e){e.name=e.device,e.value=parseInt(e.cnt),o.push(e)})):$(".none-device").show(),i.SystemVersionPie("J_getModel",o,1)}})},SystemVersionPie:function(t,e,a){e.length>20&&($.each(e,function(t,a){t>20&&(e[20].value+=parseInt(a.cnt))}),e.length=21,e[20].name="其他");var n=echarts.init(document.getElementById(t)),i={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"系统版本",type:"pie",radius:["0%","25%"],center:["50%","55%"],color:["#ff6f36","#f6ca4a","#b6a2de","#2ec7c9","#5ab1ef","#ffb980","#89c997","#00bdf2","#8d98b3","#d87a80","#dc69aa","#95706d"],label:{normal:{show:!0},emphasis:{show:!0}},labelLine:{normal:{show:!0,length:0,length2:70}},data:e}]};1===a&&(i.series[0].name="品牌/机型:"),n.setOption(i),window.addEventListener("resize",function(){setTimeout(function(){n.resize()},500)})}};return t[e.name]=e,t}(DfttModule||{});$(function(){$.each(DfttModule,function(t,e){$.isPlainObject(e)?$.isFunction(e.init)?e.init():console.error(e.init+" is not a Function!"):console.error(e+" is not a PlainObject!")})});