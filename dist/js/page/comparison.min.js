var DfttModule=function(t){var e={name:"Overview",typed:null,channel:"",baseUrl:"http://tongji.021.com/datacenterapi/",init:function(){var t=this;t.writeAppkey(),t.writeAppName(),t.drawAppicon(),t.getAppInfo(),t.getQidList(),t.getAmountStatistics(),t.amountStatistics(),t.growthTrendStatistics(),t.increaseStatistics(),t.gotoLink(),t.valuePicker(),t.showQidForm()},getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(e);return null!=a?decodeURIComponent(a[2]):null},writeAppkey:function(){var t=$.cookie("appkey");t&&"null"!==t&&$("#app_key").text(t)},drawAppicon:function(){var t=$.cookie("img");t&&"null"!==t&&$("#app_icon").attr("src",t)},writeAppName:function(){var t=$.cookie("appName");t&&$("#app_name").text(t)},getAppInfo:function(){var t=this;$.ajax({url:"http://api.shareinstall.com/appliance/getone",data:{app_key:$.cookie("appkey")},type:"POST",success:function(e){var a=e.data.app_over_time.replace(/-/g,"/"),n=parseInt(new Date(a)-new Date)/1e3/60/60/24;e.code=parseInt(e.code),0===e.code&&(0==e.data.status?t.pageInit():n<=10&&2==e.data.status&&t.pageInit(n))}})},pageInit:function(t){var e=$("#paymentInfo"),a=0;t&&(e.find(".pop-status").text("还有"+Math.round(t)+"天服务将过期"),a=1),a&&!$.cookie("warnshow"+$.cookie("appkey"))?($.cookie("warnshow"+$.cookie("appkey"),1,{expires:1}),layer.open({title:"到期提醒",type:1,area:"800",content:e,closeBtn:a})):a||layer.open({title:"到期提醒",type:1,area:"800",content:e,closeBtn:a})},gotoLink:function(){var t=this.getQueryString("key"),e=this.getQueryString("icon");$("#my-android").on("click",function(){window.location.href="./android.html?key="+t+"&icon="+e})},ajaxGet:function(t,e,a,n){e.appkey=$.cookie("appkey"),$.ajax({type:"get",url:this.baseUrl+t,data:e,dataType:"jsonp",jsonp:"callbackparam",success:function(t){a(t)},error:function(t){n(t)}})},getQidList:function(){var t=this;$.ajax({url:"http://api.shareinstall.com/channel/getlist",data:{app_key:$.cookie("appkey"),username:$.cookie("userName"),token:$.cookie("_token"),page:1,size:1e3,startDate:"20180328",endDate:"20180328",plantform:"all",exclude:0,sortname:"createTime",sorttype:"asc",search:{channel_name:""}},type:"POST",async:!1,success:function(e){if(0==e.code){var a=e.data,n="";$.each(a,function(e,a){n+="<li>",n+='<div class="fl w30">',e<5?(t.channel+=a.channel_code+"|",n+='<input type="checkbox" name="" id="" checked>'):n+='<input type="checkbox" name="" id="">',n+="</div>",n+='<div class="fl w30 qid-code">'+a.channel_code+"</div>",n+='<div class="fl w30 qid-name">'+a.channel_name+"</div>",n+="</li>"}),$(".qidtable-list").html(n),t.channel=t.channel.substr(0,t.channel.length-1)}}})},showQidForm:function(){var t=this,e=$("#selectQid");$("#select_btn").on("click",function(){layer.open({title:"选择要对比的渠道",type:1,area:"800",content:e,closeBtn:1,btn:["确定","取消"],yes:function(e){var a=$("input:checked").parents(".w30").siblings(".qid-code");t.channel="",a.each(function(e,n){t.channel+=$(n).text(),e!==a.length-1&&(t.channel+="|")}),layer.close(e),$(".data_profile .active").click()}})}),e.on("change","input",function(){0===$("input:checked").length&&$(this).prop("checked",!0),$("input:checked").length>5&&($(this).prop("checked",!1),layer.msg("最多可选择5个渠道"))})},valuePicker:function(t){var e=this;$(".date-container").on("click",function(t){"date-value"!==t.target.className&&$(this).find(".date-value").click()}),$(document).on("click",".overlay-btn",function(){var t=$(this).siblings(".time").find(".date-value"),a=t.attr("date-value")?t.attr("date-value").split(","):"undefined",n="all",i=!1,s=0;$(this).parents(".title").find(".data_profile li").each(function(t,e){$(e).hasClass("active")&&(n=$(e).attr("data-value"))}),$(this).parents(".title").siblings(".contentER, .btnBox").find('[data-name="type"]').each(function(t,e){$(e).hasClass("active")&&(s=$(e).attr("data-value"))}),$(this).hasClass("active")?$(this).removeClass("active").attr("data-value","false"):($(this).addClass("active").attr("data-value","true"),i=!0),e.getAmountStatistics(a,t,i,n,s)}),$(document).on("click",".data_profile li",function(){var t=$(this).parents(".title").find(".date-value"),a=t.attr("date-value")?t.attr("date-value").split(","):"undefined",n=$(this).attr("data-value"),i=$(this).parents(".title").find(".overlay-btn").attr("data-value"),s=0;$(this).parents(".title").siblings(".contentER, .btnBox").find('[data-name="type"]').each(function(t,e){$(e).hasClass("active")&&(s=$(e).attr("data-value"))}),$(this).addClass("active").siblings("li").removeClass("active"),e.getAmountStatistics(a,t,i,n,s)}),$(document).on("click",'[data-name="type"]',function(){var t=$(this).parents(".btnBox, .contentER").siblings(".title").find(".date-value"),a=t.attr("date-value")?t.attr("date-value").split(","):"undefined",n="all",i=$(this).attr("data-value"),s=$(this).parents(".btnBox, .contentER").siblings(".title").find(".overlay-btn").attr("data-value");$(this).parents(".btnBox").siblings(".title").find(".data_profile li").each(function(t,e){$(e).hasClass("active")&&(n=$(e).attr("data-value"))}),$(this).addClass("active").siblings().removeClass("active"),e.getAmountStatistics(a,t,s,n,i)})},initTime:function(t,e){var a=this,n={maxDate:moment(),dateLimit:{days:30},showDropdowns:!1,showWeekNumbers:!1,timePicker:!1,timePickerIncrement:60,timePicker12Hour:!1,ranges:{"所有":[moment("20160101","YYYYMMDD"),moment()],"今日":[moment().startOf("day"),moment()],"昨日":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7日":[moment().subtract("days",6),moment()],"最近30日":[moment().subtract("days",29),moment()]},opens:"left",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary blue",cancelClass:"btn-small",format:"YYYY/MM/DD",separator:" to ",locale:{applyLabel:"确定",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1}},i=i||"今日";t.html(i),t.daterangepicker(n,function(e,n,i){var i="自定义"==i?e.format("YYYY/MM/DD")+" - "+n.format("YYYY/MM/DD"):i;t.html(i);var s=[e.format("YYYYMMDD"),n.format("YYYYMMDD")];t.attr("date-value",s);var o=t.parents("time").siblings("overlay-btn").attr("data-value"),r="all";t.parents(".title").find(".data_profile li").each(function(t,e){$(e).hasClass("active")&&(r=$(e).attr("data-value"))});var l=0;t.parents(".title").siblings(".contentER, .btnBox").find('[data-name="type"]').each(function(t,e){$(e).hasClass("active")&&(l=$(e).attr("data-value"))}),a.getAmountStatistics(s,t,o,r,l)})},initEchartsBar:function(t,e,a){var n=echarts.init(document.getElementById(t)),i={tooltip:{trigger:"axis"},yAxis:{type:"value",min:0,minInterval:1,boundaryGap:"10%"},legend:{data:e},xAxis:{type:"category",boundaryGap:!0,data:["访问量","安装量","注册量"]},series:a};n.setOption(i),window.addEventListener("resize",function(){setTimeout(function(){n.resize()},500)})},initEchartsPie:function(t,e,a){var n=echarts.init(document.getElementById(t)),i={backgroundColor:"#fff",title:{x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},calculable:!0,series:[{name:e,type:"pie",radius:[20,50],color:["#00a3fe","#45dbda"],center:["50%","50%"],label:{normal:{show:!0},emphasis:{show:!0}},itemStyle:{normal:{borderWidth:2,borderColor:"#fff",label:{show:!1},labelLine:{show:!0,length:.001}}},data:a}]};n.setOption(i),window.addEventListener("resize",function(){setTimeout(function(){n.resize()},500)})},initEchartsCategory:function(t,e,a,n){var i=echarts.init(document.getElementById(t)),s={tooltip:{trigger:"axis"},legend:{data:a},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:[{type:"value"}],series:n};i.setOption(s),window.addEventListener("resize",function(){setTimeout(function(){i.resize()},500)})},initEchartsCategoryActive:function(t,e,a,n,i){var s=echarts.init(document.getElementById(t));console.log(e);var o;o={tooltip:{trigger:"axis"},legend:{data:a},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:[{type:"value"}],series:n},s.setOption(o),window.addEventListener("resize",function(){setTimeout(function(){s.resize()},500)})},initEchartsInstallRegister:function(t,e,a){for(var n=this.channel,i=n.split("|"),s=this,o={startDate:t[0],endDate:t[1],appkey:"K6BKB62B7BHABH",exclude:e,platform:a,channel:n},r=[],l=0;l<i.length;l++)r.push({name:i[l],type:"bar",data:[0,0,0],barWidth:20});this.ajaxGet("shareinstallgatherdata/shareinstallqidmanager",o,function(t){if(200===t.code){var e=t.datalist;$.each(e,function(t,e){e&&$.each(i,function(t,a){e.channel===a&&(r[t].data[0]=e.visit_cnt,r[t].data[1]=e.install_cnt,r[t].data[2]=e.register_cnt)})}),s.initEchartsBar("J_total",i,r)}})},growthTrend:function(t,e,a,n){for(var i=this,s="J_trend",o=i.channel,r=o.split("|"),l={startDate:t[0],endDate:t[1],appkey:"K6BKB62B7BHABH",exclude:e,platform:a,channel:o},c={},d=[],h=[],u=[],p=[],m=[],f=[],v=[],g=0;g<r.length;g++)c[r[g]]=[];this.ajaxGet("shareinstallgatherdata/shareinstallqidgrow",l,function(e){if(200===e.code){var a=e.datalist.reverse();if(a.length>0){$.each(a,function(e,a){c[a.channel]&&c[a.channel].push(a),t[0]===t[1]?d.indexOf(a.hh)<0&&d.push(a.hh):d.indexOf(a.dt)<0&&d.push(a.dt)});for(var o=0;o<r.length;o++){m[o]=[],f[o]=[],v[o]=[];for(var l=0;l<c[r[o]].length;l++)m[o].push(c[r[o]][l].install_cnt),f[o].push(c[r[o]][l].register_cnt),v[o].push(c[r[o]][l].visit_cnt);h.push({name:r[o],type:"line",data:m[o],animationDuration:1e3,animationDurationUpdate:1e3,smooth:!0,symbol:"none"}),u.push({name:r[o],type:"line",data:f[o],animationDuration:1e3,animationDurationUpdate:1e3,smooth:!0,symbol:"none"}),p.push({name:r[o],type:"line",data:v[o],animationDuration:1e3,animationDurationUpdate:1e3,smooth:!0,symbol:"none"})}1==n?i.initEchartsCategory(s,d,r,h):2==n?i.initEchartsCategory(s,d,r,u):i.initEchartsCategory(s,d,r,p)}}})},amountStatistics:function(){var t=this,e=$("#total");t.initTime(e)},getAmountStatistics:function(t,e,a,n,i){var s=this;if(void 0==t||"undefined"==t){t=[(new Date).getFullYear()+""+((new Date).getMonth()+1>9?(new Date).getMonth()+1:"0"+((new Date).getMonth()+1))+((new Date).getDate()>9?(new Date).getDate():"0"+(new Date).getDate()),(new Date).getFullYear()+""+((new Date).getMonth()+1>9?(new Date).getMonth()+1:"0"+((new Date).getMonth()+1))+((new Date).getDate()>9?(new Date).getDate():"0"+(new Date).getDate())]}if(void 0==a&&(a=!1),void 0==e)s.initEchartsInstallRegister(t,a,n),s.growthTrend(t,a,n,i),s.increaseTrend(t,a,n,i);else{var o=e.attr("id");"total"==o?s.initEchartsInstallRegister(t,a,n):"trend"==o?s.growthTrend(t,a,n,i):"increase"==o&&s.increaseTrend(t,a,n,i)}},growthTrendStatistics:function(){var t=this,e=$("#trend");t.initTime(e)},increaseStatistics:function(){var t=this,e=$("#increase");t.initTime(e,!0)},increaseTrend:function(t,e,a,n){for(var i,s=this,o=s.channel,r=o.split("|"),l={startDate:t[0],endDate:t[1],appkey:"K6BKB62B7BHABH",platform:a,type:"00"===n?"0":n,channel:o},c={},d=[],h=[],u=[],p=[],m=[],f=[],v=[],g=[],y=[],b=0;b<r.length;b++)c[r[b]]=[];this.ajaxGet("shareinstallgatherdata/shareinstallqidactive",l,function(e){if(200===e.code){var a=e.datalist.reverse();if(a.length>0){$.each(a,function(e,a){c[a.channel]&&c[a.channel].push(a),"1"===n||"2"===n?d.indexOf(a.dt)<0&&d.push(a.dt):t[0]===t[1]?d.indexOf(a.hh)<0&&d.push(a.hh):d.indexOf(a.dt)<0&&d.push(a.dt)});for(var o=0;o<r.length;o++){f[o]=[],v[o]=[],g[o]=[],y[o]=[];for(var l=0;l<c[r[o]].length;l++)f[o].push(c[r[o]][l].act_cnt),v[o].push(c[r[o]][l].register_act),g[o].push(c[r[o]][l].act_rate),y[o].push(c[r[o]][l].act_time);h.push({name:r[o],type:"line",data:f[o],animationDuration:1e3,animationDurationUpdate:1e3,smooth:!0,symbol:"none"}),u.push({name:r[o],type:"line",data:v[o],animationDuration:1e3,animationDurationUpdate:1e3,smooth:!0,symbol:"none"}),p.push({name:r[o],type:"line",data:g[o],animationDuration:1e3,animationDurationUpdate:1e3,smooth:!0,symbol:"none"}),m.push({name:r[o],type:"line",data:y[o],animationDuration:1e3,animationDurationUpdate:1e3,smooth:!0,symbol:"none"})}i="00"===n?u:"1"===n?p:"2"===n?m:h,console.log(m),s.initEchartsCategoryActive("J_increase",d,r,i,n)}}})},getSystemVersion:function(t,e,a,n){var i=this,s={startDate:moment().subtract("days",1).startOf("day").format("YYYYMMDD"),endDate:moment().subtract("days",1).endOf("day").format("YYYYMMDD"),appkey:"K6BKB62B7BHABH",exclude:e,platform:a||"android"},o=[];this.ajaxGet("shareinstallgatherdata/shareinstallsysvergather",s,function(t){if(200===t.code){var e=t.datalist;e.length>0?($(".none-sysver").hide(),$.each(e,function(t,e){e.name=e.osver,e.value=parseInt(e.cnt),o.push(e)})):$(".none-sysver").show(),i.SystemVersionPie("J_systemVersion",o)}})},getModel:function(t,e,a,n){var i=this,s={startDate:moment().subtract("days",1).startOf("day").format("YYYYMMDD"),endDate:moment().subtract("days",1).endOf("day").format("YYYYMMDD"),appkey:"K6BKB62B7BHABH",exclude:e,platform:a||"android"},o=[];this.ajaxGet("shareinstallgatherdata/shareinstallbranddevicegather",s,function(t){if(200===t.code){var e=t.datalist;e.length>0?($(".none-device").hide(),$.each(e,function(t,e){e.name=e.device,e.value=parseInt(e.cnt),o.push(e)})):$(".none-device").show(),i.SystemVersionPie("J_getModel",o,1)}})},SystemVersionPie:function(t,e,a){var n=echarts.init(document.getElementById(t)),i={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"系统版本",type:"pie",radius:["40%","80%"],color:["#ff6484","#00a3fe","#4cc0c0","#ffb957"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!0,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!0}},label:{normal:{show:!0},emphasis:{show:!0}},data:e}]};1===a&&(i.series[0].name="品牌/机型:"),n.setOption(i),window.addEventListener("resize",function(){setTimeout(function(){n.resize()},500)})}};return t[e.name]=e,t}(DfttModule||{});