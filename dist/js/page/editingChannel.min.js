var DfttModule=function(e){var n={name:"Channel",typed:null,pageType:1,init:function(){var e=this;e.writeAppkey(),e.drawAppicon(),e.writeAppName(),e.judgeIsNew(),e.changeRadio(),e.saveChannel()},writeAppkey:function(){var e=$.cookie("appkey");e&&($("#app_key").text(e),$("#configAppKey").text(e))},drawAppicon:function(){var e=$.cookie("img");e&&$("#app_icon").attr("src",e)},writeAppName:function(){var e=$.cookie("appName");e&&$("#app_name").text(e)},getQueryString:function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(n);return null!=a?decodeURIComponent(a[2]):null},normalizeUrl:function(e,n){if(!e||!(e=$.trim(e)))return null;var a=!0===n?/^([0-9a-zA-Z_\-]+):\/\/[^\/]+(\/.*)?/i:/^(http|https):\/\/[^\/]+(\/.*)?/i,t=a.exec(e);return t?(t[2]||(e+="/"),e):null},judgeIsNew:function(){var e=this.getQueryString("channelId");return!!e&&($("#_title").text("渠道管理-修改渠道"),this.getChannelInfo(e),!0)},getChannelInfo:function(e){var n=this;$.ajax({url:"http://api.shareinstall.com/channel/getone",type:"POST",data:{username:$.cookie("userName"),token:$.cookie("_token"),app_key:$.cookie("appkey"),channel_id:e},success:function(e){"0"===e.code&&($("#link_code").val(e.data.channel_code).prop("disabled",!0),$("#link_name").val(e.data.channel_name),$('input[name="customURL"]').val(e.data.page),n.pageType=e.data.page_type,$('input[name="defaultLanding"]').each(function(n,a){$(a).prop("checked",!1),n===e.data.page_type-1&&$(a).prop("checked",!0)}),n.showPageUrl())}})},saveChannel:function(){var e=this;$("#submit_btn").on("click",function(){var n=$("#link_code").val(),a=$("#link_name").val(),t=$('input[name="customURL"]').val(),i=!0,o="http://api.shareinstall.com/channel/create",p={username:$.cookie("userName"),token:$.cookie("_token"),app_key:$.cookie("appkey"),channel_code:n,channel_name:a,page_type:e.pageType,page:t};n||(layer.tips("必填",$('input[name="channelCode"]'),{tipsMore:!0,tips:[2,"#ff3333"]}),i=!1),a||(layer.tips("必填",$('input[name="channelName"]'),{tipsMore:!0,tips:[2,"#ff3333"]}),i=!1),e.normalizeUrl(t)||2!==e.pageType||(layer.tips("请填写合法的url，如：http://www.shareinstall.com/",$('input[name="customURL"]'),{tipsMore:!0,tips:[2,"#ff3333"]}),i=!1),1===e.pageType&&(t=""),e.getQueryString("channelId")&&(o="http://api.shareinstall.com/channel/update",p.channel_id=e.getQueryString("channelId")),i&&$.ajax({url:o,type:"POST",data:p,success:function(e){"0"===e.code||0===e.code?window.location.href="./management.html":88===parseInt(e.code)?(layer.msg("登录失效，请重新登录"),setTimeout(function(){window.location.href="./login.html"},3e3)):4==e.code?layer.msg(e.message):layer.msg("保存失败")},error:function(){layer.msg("保存失败")}})})},changeRadio:function(){var e=this;$('input:radio[name="defaultLanding"]').on("click",function(){"false"===$(this).val()?($("#zi_url").show(),e.pageType=2):($("#zi_url").hide(),e.pageType=1)})},showPageUrl:function(){2===this.pageType?$("#zi_url").show():$("#zi_url").hide()}};return e[n.name]=n,e}(DfttModule||{});