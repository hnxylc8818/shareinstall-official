var DfttModule=function(dm){var Index={name:"Index",typed:null,init:function(){var e=this;e.writeAppkey(),e.writeAppName(),e.drawAppicon(),e.tabsFun(),e.uploadPackage(),e.gotoLink(),e.getPackageInfo(),e.configApp()},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?decodeURIComponent(n[2]):null},writeAppkey:function(){var e=$.cookie("appkey");e&&($("#app_key").text(e),$("#configAppKey").text(e))},drawAppicon:function(){var e=$.cookie("img");e&&$("#app_icon").attr("src",e)},writeAppName:function(){var e=$.cookie("appName");e&&$("#app_name").text(e)},gotoLink:function(){},tabsFun:function(){$(".tab-form li").on("click",function(){$(this).addClass("active").siblings().removeClass("active");var e=$(this).index();$("#tab-panel .my-app").eq(e).show().siblings().hide()})},prevFun:function(){$(".step_prev").on("click",function(){var e=parseInt($(this).attr("data-tab-index"))-1;$(".tabs-item").eq(e).addClass("active").parent("div").siblings().children("a").removeClass("active"),$("#steps").children(".step").eq(e).show().siblings().hide()})},nextFun:function(){$(".step_next").on("click",function(){var e=parseInt($(this).attr("data-tab-index"))+1;$(".tabs-item").eq(e).addClass("active").parent("div").siblings().children("a").removeClass("active"),$("#steps").children(".step").eq(e).show().siblings().hide()})},uploadPackage:function(){function upfile(){if(start=0,end=LENGTH+start,blob_num=1,!(file=document.getElementsByName("mof")[0].files[0]))return void alert("请选择文件");up()}function up(){var total_blob_num=Math.ceil(file.size/LENGTH);start<file.size&&(xhr.open("POST","http://api.shareinstall.com/passage/upload",!0),xhr.onreadystatechange=function(){4==this.readyState&&(console.log(this),console.log(this.status),this.status>=200&&this.status<300?(console.log(this.responseText),console.log(this.responseText.code),tmp=this.responseText,resp=eval("("+tmp+")"),console.log(typeof resp),console.log(resp.code),resp.code<0?(alert("文件发送失败，请重新发送"),des.style.width="0%"):(start=end,end=start+LENGTH,blob_num==total_blob_num&&setTimeout(function(){$.ajax({async:!1,type:"POST",url:"http://api.shareinstall.com/passage/check",data:{app_key:appKey},success:function(e){if("0"===e.code){var t=new Date(1e3*e.data.createTime);e.data.createTime=t.getFullYear()+"/"+(t.getMonth()+1>9?t.getMonth()+1:"0"+(t.getMonth()+1))+"/"+(t.getDate()>9?t.getDate():"0"+t.getDate());var n=$(".pkgInfoTmp").html(),a=Handlebars.compile(n),o=a(e.data);$(".pkgInfoContainer").html(o),$("#configAppId").html(e.data.application_id),$("#configScheme").html(e.data.scheme),$(".btn-upload-back").click()}else layer.msg(e.message||"文件解析失败")}})},2e3),blob_num+=1,setTimeout(function(){up()},1e3))):(alert("文件发送失败，请重新发送"),des.style.width="0%"))},xhr.upload.onprogress=function(e){e.lengthComputable&&(pecent=100*(e.loaded+start)/file.size,pecent>100&&(pecent=100),des.style.width=pecent+"%",des.innerHTML=parseInt(pecent)+"%")},blob=file.slice(start,end),fd=new FormData,fd.append("mof",blob),fd.append("filename",file.name),fd.append("blob_num",blob_num),fd.append("total_blob_num",total_blob_num),fd.append("app_key",appKey),xhr.send(fd))}function change(){des.style.width="0%"}$(".btn-to-upload").on("click",function(){$(".deposite_upload").show(),$(".btn-to-upload").hide(),$(".pkgInfoContainer").hide()}),$(".btn-upload-back").on("click",function(){$(".deposite_upload").hide(),$(".btn-to-upload").show(),$(".pkgInfoContainer").show()}),$(".upload-filebtn").on("change",function(){$("#upimg").show(),upfile()});var xhr=new XMLHttpRequest,fd,des=document.getElementById("load"),num=document.getElementById("upimg"),file;const LENGTH=5242880;var start,end,blob,pecent,filename,appKey=$.cookie("appkey")},getPackageInfo:function(){var e=$.cookie("appkey");$.ajax({url:"http://api.shareinstall.com/passage/info",type:"POST",data:{username:$.cookie("userName"),token:$.cookie("_token"),app_key:e,plantform:"android"},success:function(e){if("0"===e.code){var t=new Date(1e3*e.data.createTime);e.data.createTime=t.getFullYear()+"/"+(t.getMonth()+1>9?t.getMonth()+1:"0"+(t.getMonth()+1))+"/"+(t.getDate()>9?t.getDate():"0"+t.getDate());var n=$(".pkgInfoTmp").html(),a=Handlebars.compile(n),o=a(e.data);$(".pkgInfoContainer").html(o),$("#configAppId").html(e.data.application_id),$("#configScheme").html(e.data.scheme)}}})},configApp:function(){$('input[name="yybEnabled"]').on("change",function(){$(this).prop("checked")?$('input[name="yybUrl"]').prop("disabled",!1):$('input[name="yybUrl"]').prop("disabled",!0)}),$(".btn_submit").on("click",function(){layer.msg("保存成功")})}};return dm[Index.name]=Index,dm}(DfttModule||{});$(function(){$.each(DfttModule,function(e,t){$.isPlainObject(t)?$.isFunction(t.init)||console.error(t.init+" is not a Function!"):console.error(t+" is not a PlainObject!")})});