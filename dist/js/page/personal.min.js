var DfttModule=function(e){var i={name:"Index",typed:null,init:function(){var e=this;e.url="http://api.shareinstall.com/",e.login(),e.loginOut(),e.getuser(),e.ModifyPassword(),e.closeLayer1(),e.primaryEmail(),e.ModifyPhone(),e.grxxCode(),e.primaryPhone(),e.closeLayer2(),e.backTop()},backTop:function(){$("#J_barBack").on("click",function(){$("body,html").animate({scrollTop:0},500)})},login:function(){var e=$.cookie("_token");"null"==e||void 0==e?window.location.href="./login.html":$("#username").html($.cookie("userName"))},loginOut:function(){var e=this;$("#loginOut").on("click",function(){$.ajax({url:e.url+"login/logout",type:"post",data:{username:$.cookie("userName"),token:$.cookie("_token")},success:function(e){"string"==typeof e&&(e=JSON.parse(e)),"0"==e.code&&($.cookie("_token",null),$.cookie("userName",null),window.location.href="./index.html")}})})},getuser:function(){var e=this,i=e.url+"account/info";$.ajax({url:i,type:"post",data:{username:$.cookie("userName"),token:$.cookie("_token")},success:function(e){0==e.code&&($("#uesrTime").html(e.data.register_time),$("#uesrEmail").html(e.data.email),$("#userPhone").html(e.data.mobile),$.cookie("_phone",e.data.mobile))}})},ModifyPassword:function(){$("#person_pass").on("click",function(){layer.open({type:1,title:!1,closeBtn:!1,skin:"layui-layer-nobg",area:["680px","348px"],shadeClose:!1,content:'<div><div class="grxx"><div class="grxx_title"><div class="grxx_title_left"><p><img src="./img/console/gexx2.jpg"></p>修改密码</div><a class="grxx_title_right" id="grxx_right1" href="javascript:;"><img src="./img/console/gexx4.jpg"></a></div><div class="grxx_main"><ul><li><p>旧密码</p><input class="old_pwd"  placeholder="请输入旧密码" name="textfield" type="password" value=""></li><li><p>新密码</p><input class="new_pwd"  placeholder="请输入新密码" name="textfield" type="password" value=""></li><li><p>确认新密码</p><input class="new_pwd2" placeholder="请再次输入新密码" name="textfield" type="password" value=""></li><div class="grxx_anniu"><button type="button" class="btn btn-primary"  id="primaryEmail" style="margin-top: 20px">提  交</button></div></ul></div></div></div>'})})},closeLayer1:function(){$("body").on("click","#grxx_right1",function(){layer.closeAll()})},closeLayer2:function(){$("body").on("click","#grxx_right2",function(){layer.closeAll()})},primaryEmail:function(){var e=this;$("body").on("click","#primaryEmail",function(){var i=$(".old_pwd").val(),t=$(".new_pwd").val(),o=$(".new_pwd2").val(),n=/^[a-zA-Z0-9_.]{6,12}/;if(i&&t&&o){if(!n.test(i))return layer.tips("密码为6-12位（英文字母，数字，下划线）的组合",".old_pwd",{tipsMore:!0,tips:[2,"#ff3333"]});if(!n.test(t))return layer.tips("密码为6-12位（英文字母，数字，下划线）的组合",".new_pwd",{tipsMore:!0,tips:[2,"#ff3333"]});if(!n.test(o))return layer.tips("密码为6-12位（英文字母，数字，下划线）的组合",".new_pwd2",{tipsMore:!0,tips:[2,"#ff3333"]});if(t!=o)return void layer.msg("两次密码不一样",{icon:2,time:1500});$("#primaryEmail").addClass("disabled"),$.ajax({url:e.url+"account/changepwd",type:"post",data:{username:$.cookie("userName"),token:$.cookie("_token"),old_password:i,new_password:t},success:function(e){0==e.code?($("#primaryEmail").removeClass("disabled"),layer.msg("修改成功",{icon:1,time:2e3},function(){layer.closeAll()})):layer.msg(e.message)}})}else layer.msg("密码都必须填写",{icon:1,time:1500})})},ModifyPhone:function(){$("#person_iphone").on("click",function(){layer.open({type:1,title:!1,closeBtn:!1,skin:"layui-layer-nobg",area:["680px","348px"],shadeClose:!1,content:'<div><div class="grxx"><div class="grxx_title"><div class="grxx_title_left"><p><img src="./img/console/gexx3.jpg"></p>修改手机号码</div><a href="javascript:;" class="grxx_title_right" id="grxx_right2"><img src="./img/console/gexx4.jpg"></a></div><div class="grxx_main"><ul><li><p>新手机号</p><label><input id="input_phone"  placeholder="请输入手机号码" name="textfield" type="text" value=""></label></li><li><p>验证码</p><label class="code_phone"><input id="input_code" style="width: 200px"  placeholder="请输入手机验证码" name="textfield" type="text" value=""><a  href="javascript:;" style=" margin-left: 15px"; id="grxx-code" data-click="1">点击获取验证码</a><span style="margin-left: 15px;display: none;">32秒后可重新获取</span></label></li><div class="grxx_anniu"><button type="button" class="btn btn-primary" id="primaryPhone" style="margin-top: 20px">提  交</button></div></ul></div></div></div>'})})},grxxCode:function(){var e=this;$("body").on("click","#grxx-code",function(){if(1==$("#grxx-code").attr("data-click")){var i=e.url+"account/getsms",t=$("#input_phone").val();if(!/^1[3|4|5|7|8]\d{9}$/.test(t))return layer.tips("请输入正确的手机号码","#input_phone",{tipsMore:!0,tips:[2,"#ff3333"]}),void $("#input_phone").focus();$("#grxx-code").attr("data-click","0"),$.ajax({url:i,type:"post",data:{username:$.cookie("_phone"),token:$.cookie("_token"),mobile_num:t},success:function(e){function i(){$("#grxx-code").html("点击获取验证码"),$("#grxx-code").attr("data-click","1"),$("#grxx-code").css("color","#1dd2af")}if(0==e.code)layer.msg("发送成功",{icon:1,time:2e3}),$("#grxx-code").html("已发送，请注意查收"),$("#grxx-code").css("color","#999"),window.setTimeout(i,6e4);else{var t=e.message;$("#grxx-code").html(t),$("#grxx-code").css("color","#999"),$("#grxx-code").attr("data-click","1")}}})}})},primaryPhone:function(){var e=this;$("body").on("click","#primaryPhone",function(){var i=/^1[3|4|5|7|8]\d{9}$/,t=/^\d{6}$/,o=$("#input_phone").val(),n=$("#input_code").val();if(""!=o&&""!=n&&!$("#primaryPhone").hasClass("disabled")){if(!i.test(o))return layer.tips("请输入正确的手机号码","#input_phone",{tipsMore:!0,tips:[2,"#ff3333"]}),void $("#input_phone").focus();if(!t.test(n))return layer.tips("请输入6位数字的短信验证码","#input_code",{tipsMore:!0,tips:[2,"#ff3333"]}),void $("#register_code").focus();$("#primaryPhone").addClass("disabled"),$.ajax({url:e.url+"account/changemobile",type:"post",data:{username:$.cookie("userName"),token:$.cookie("_token"),new_mobile:o,sms_code:n},success:function(i){0==i.code&&($("#primaryPhone").removeClass("disabled"),$.cookie("userName",o),e.getuser(),layer.msg("修改成功",{icon:1,time:2e3},function(){layer.closeAll()}))}})}})}};return e[i.name]=i,e}(DfttModule||{});$(function(){$.each(DfttModule,function(e,i){$.isPlainObject(i)?$.isFunction(i.init)?i.init():console.error(i.init+" is not a Function!"):console.error(i+" is not a PlainObject!")})});