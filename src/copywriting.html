<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>文档中心</title>
    <link rel="stylesheet" href="./css/common/base.min.css">
    <link rel="stylesheet" href="./css/page/copywriting.min.css">
    <link href="http://cdn.bootcss.com/highlight.js/8.0/styles/monokai_sublime.min.css" rel="stylesheet">
    <script src="http://cdn.bootcss.com/highlight.js/8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
<!--banner-->
<div class="my-banner">
    <div class="my-banner-top clearfix">
        <a href="./index.html">
            <div class="banner-left fl">

            </div>
        </a>

        <div class="banner-right fr">
            <ul class="banner-nav fl clearfix">
                <li>
                    <a href="./index.html">产品</a>
                    <a href="./scene.html">场景</a>
                    <a href="javascript:volid(0);" class="active">文档</a>
                    <!--<a href="">下载中心</a>-->
                    <a href="./about.html">关于我们</a>
                </li>
            </ul>
            <!--<div class="logo fl clearfix">-->
            <!--<a href="" class="fl console">控制台</a>-->
            <!--<a href="" class="fl apply">申请使用</a>-->
            <!--</div>-->
        </div>
    </div>
    <div class="my-banner-bottom container">
        <span class="typed-element">集成文档</span>
        <div class="copy">
            <div class="android active activeAn" data-index="android">
                <span class="icon"></span>
                <span class="txt">Android集成</span>
            </div>
            <div class="ios" data-index="ios">
                <span class="icon"></span>
                <span class="txt">ios集成</span>
            </div>
            <div class="web" data-index="web">
                <span class="icon"></span>
                <span class="txt">web集成</span>
            </div>
        </div>
    </div>
</div>
<div class="app" id="J_app">
    <!--android-->
    <div class="my-android container my-app">
        <!--<h1>下载最新的Android SDK</h1>-->
        <!--<div class="download">-->
        <!--<span class="fl name">Android SDK</span>-->
        <!--<div class="fr">-->
        <!--<span class="fl">74kb</span>-->
        <!--<span class="fl edition">v1.0.0</span>-->
        <!--<button class="fl ">下载</button>-->
        <!--</div>-->
        <!--</div>-->
        <h1 style="margin-top: 0;">导入SDK</h1>
        <h2>将aar文件拷贝到项目的libs文件夹下，并导入</h2>
        <div>
<pre style="width:400px;height:140px">
<code style="width: 100%;height: 80%;" class="lang-javascript">
dependencies {
    compile(name: 'ShareInstall_1.0.0', ext: 'aar')
}
</code>
</pre>
            <h1>基础配置</h1>
            <h2>在AndroidMainfest.xml中添加权限声明</h2>
            <pre style="width:600px;height:100px">
<code style="width: 100%;height: 80%;" class="lang-javascript">
&lt;uses-permission android:name="android.permission.INTERNET" /&gt;
&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;
</code>
</pre>
            <h2>在自定义Application中调用SHShareInstallSDK.getInstance().init(context)方法完成SDK初始化</h2>
            <pre style="width:900px;height:540px">
<code style="width: 100%;height: 96%;" class="lang-javascript">
public class MyApp extends Application {

    @Override
    public void onCreate() {
        super.onCreate();
        if (isMainProcess()) {
            SHShareInstallSDK.getInstance().init(getApplicationContext());
        }
    }

    /**
     * 判断当前进程是否是应用的主进程
     *
     * @return
     */
    public boolean isMainProcess() {
        int pid = android.os.Process.myPid();
        ActivityManager activityManager = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);
        for (ActivityManager.RunningAppProcessInfo appProcess : activityManager.getRunningAppProcesses()) {
            if (appProcess.pid == pid) {
                return getApplicationInfo().packageName.equals(appProcess.processName);
            }
        }
        return false;
    }
}
</code>
</pre>
            <h2>在AndroidMainfest.xml中的application标签中添加
                android:name=".MyApplication"指定自定义的Application类，以便程序启动的时候初始化自<br/>
                定义Application类，而不是系统默认的Application类
            </h2>
            <pre style="width:400px;height:200px">
<code style="width: 100%;height: 91%;" class="lang-javascript">
&lt;application
        android:name=".MyApplication"
        android:allowBackup="false"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:supportsRtl="true"
        android:theme="@style/AppTheme">
&lt;/application&gt;
</code>
</pre>
            <h1>一键跳转</h1>
            <h2>在AndroidMainfest的唤醒页面activity标签中添加intent-filter（一般为MainActivity）, 配置scheme，用于浏览器中拉起</h2>
            <pre style="width:600px;height:250px">
<code style="width: 100%;height: 88%;" class="lang-javascript">
&lt;activity
        android:name=".MainActivity"
        android:launchMode="singleTask"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.VIEW" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
        &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
        &lt;data android:scheme="shareinstall为当前应用自动分配的schame" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</code>
</pre>
            <h2>注：如果唤醒页面和启动页是同一Activity，则AndroidMaifest.xml的配置如下</h2>
            <pre style="width:600px;height:330px">
<code style="width: 100%;height: 94%;" class="lang-javascript">
&lt;activity
        android:name=".MainActivity"
        android:launchMode="singleTask"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.MAIN" /&gt;
        &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
    &lt;/intent-filter&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.VIEW" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
        &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
        &lt;data android:scheme="shareinstall为当前应用自动分配的schame"/&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;
</code>
</pre>
            <h2>
                个性化安装和一键唤醒都调用同一个方法SHShareInstallSDK.getInstance().getInfo()获取相关信息，第一个参数为Intent，第二个参数
                为接入方应用的apptypeId(尽量传个独特唯一的值)，因为目前后台没有为接入方应用配置一个单独的appkey，所以apptypeId用来区分应用，等以后后台完善。
            </h2>
            <h1>1、个性化安装</h1>
            <h2>在APP需要个性化安装参数时（由web网页中传递过来的，如邀请码、游戏房间号等 自定义参数），调用以下方法，在回调中获取参数</h2>
            <pre style="width:700px;height:170px">
<code style="width: 100%;height: 88%;" class="lang-javascript">
SHShareInstallSDK.getInstance().getInfo(getIntent(), "JSSTT", new AppGetInfoListener() {
    @Override
    public void onGetInfoFinish(String info) {
        Log.d("ShareInstall", "info = " + info);
    }
});
</code>
</pre>
            <h1>2、唤醒页面获取信息</h1>
            <pre style="width:600px;height:600px">
<code style="width: 100%;height: 80%;" class="lang-javascript">
public class WakeUpActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_wake_up);
        // 获取唤醒参数
        SHShareInstallSDK.getInstance().getInfo(getIntent(), "JSSTT", listener);
    }

    @Override
    protected void onNewIntent(Intent intent) {
        super.onNewIntent(intent);
        // 此处要调用，否则app在后台运行时，会无法截获
        SHShareInstallSDK.getInstance().getInfo(intent, "JSSTT", listener);
    }

    private AppGetInfoListener listener = new AppGetInfoListener() {
        @Override
        public void onGetInfoFinish(String info) {
            Log.d("ShareInstall", "info = " + info);
        }
    };
</code>
</pre>
        </div>
    </div>
    <!--ios-->
    <div class="my-ios container my-app" style="display: none">
        <h1 style="margin-top: 0;">一、产品原理</h1>
        <h2><span>精确的App安装来源与携带参数安装 ：</span>shareInstall的核心价值在于，帮助Android/iOS开发者通过shareInstall提供的sdk，精确的获取app每一次安装的分享（或推广）来源。原理如下：开发者在分享的h5页面上集成
            shareInstall web sdk,发布分享链接时在url上动态的拼接任意的自定义参数（如推广渠道号，邀请码等等）；当某一终端访问该h5页面时，shareinstall web
            sdk将同时确定该设备的个性化信息和采集自定义参数，上传至shareInstall服务器,
            待用户通过该h5页面安装app后首次打开时（如当前设备已安装该app，将直接拉起该app并传递参数），使用shareInstall Android/iOS
            sdk从shareInstall服务器再取回暂存的自定义参数。 </h2>
        <h2><span>一键拉起功能：</span>shareInstall通过标准的scheme,universal link
            等技术，在app已安装的情况下，从各种浏览器（包括微信、QQ、新浪微博、钉钉等主流社交软件的内置浏览器）拉起app并传递自定义参数，避免重复安装,如没安装则调至appStore或应用宝下载app,下载完毕唤起app的相应页面。
        </h2>
        <h1>二、iOS SDK集成</h1>
        <h2><span>1、导入SDK</span></h2>
        <h2>下载并解压最新版SDK压缩包，将libShareInstall.a和SHSmartInstallSDK.h导入工程中。</h2>
        <h2><span>2、初始化SDK</span></h2>
        <h2>在AppDelegate中，增加头文件的引用：</h2>
        <pre style="width:820px;height:250px">
<code style="width: 100%;height: 92%;" class="lang-javascript">
#import “SHSmartInstallSDK”

在-(BOOL)application:(UIApplication*)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
    方法中调用setAppKey方法来初始化SDK，如下代码所示：

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
//这里设置的是江苏头条的apptypeid ，东方头条需替换成东方头条的apptypeid，后面会完善
 [[NSUserDefaults standardUserDefaults] setObject:@"JSSTT" forKey: @"apptypeid"];
[SHSmartInstallSDK setAppKey:@"jgec0y" withDelegate:self WithOptions:launchOptions];
return YES;
}
</code>
</pre>
        <h2>注:目前后台没有为介入方应用配置一个单独的appkey,所以目前是固定的，以后会完善。</h2>
        <h2><span>3、个性化安装</span></h2>
        <h2>当应用安装后首次打开时，iOS sdk会收到网页端通过js sdk传来的自定义动态参数，精确的获取app每一次安装的分享（或推广）来源。
            比如通过在分享链接url中附带app邀请人的用户id,就可达到免填邀请码的效果；url中可拼接自定义的参数。
            在AppDelegate中，添加获取安装参数的回调方法，代码如下所示:
        </h2>
        <pre style="width:820px;height:220px">
<code style="width: 100%;height: 92%;" class="lang-javascript">
#pragma mark smartInstallDelegate
//通过ShareInstall获取自定义参数，数据为空时也会调用此方法
- (void)getInstallParamsFromSmartInstall:(id) params withError: (NSError *) error{
NSLog(@"安装参数params=%@",params);
UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"直接点击App进来的" message:[self DataTOjsonString:params] delegate:nil cancelButtonTitle:@"取消" otherButtonTitles:@"确定", nil];
    //弹出提示框（便于调试，调试完成后删除此代码）
    [alert show];
}
</code>
</pre>
        <h2><span>4、一键跳转</span></h2>
        <h2>ShareInstall通过标准的scheme,universal link等技术，在app安装的情况下，从各种浏览器（微信、QQ、新浪微博、钉钉等主流社交软件的内置浏览器）唤醒 app
            并传递自定义参数，避免重复安装。</h2>
        <h2><span>5、 universal link 配置</span></h2>
        <h2>Universal link是iOS9的一个新特性，通过Universal link, App可以通过各种浏览器跳转到App（例如微信内可不通过safari,一键跳转到App），真正实现一键跳转到相应界面。
            <br/>备注：iOS9以上推荐使用Universal link
        </h2>

        <h2><span>5.1 配置developer.apple.com的相关信息</span></h2>
        <h2>到苹果开发者中心，为当前的App ID开启Associated Domains服务：</h2>
        <img src="./img/copywriting/iOS1.jpg" alt="">
        <h2><span>5.2 配置Xcode</span></h2>
        <h2>在XCode中配置shareInstall为当前应用生成的关联域名：Associated Domains 开关打开，添加Domains。</h2>
        <img src="./img/copywriting/ios2.jpg" alt="">
        <h2>在AppDelegate中的continueUserActivity方法中调用，用来处理Universal link</h2>
        <pre style="width:800px;height:280px">
<code style="width: 100%;height: 90%;" class="lang-javascript">
//Universal Links 通用链接
- (BOOL)application:(UIApplication *)application continueUserActivity:(NSUserActivity *)userActivity restorationHandler:(void (^)(NSArray * _Nullable))restorationHandler
{
    //判断是否通过ShareInstall Universal Links 唤起App
    if ([SHSmartInstallSDK continueUserActivity:userActivity]) {
return YES ;
}else{
        //其他代码
        return YES;
    }
}
</code>
</pre>
        <h2><span>5.3 配置App的URL Scheme</span></h2>
        <h2>iOS系统中App之间是相互隔离的，通过URL Scheme, App之间可以相互调用，并且可以传递参数。
            <br/>备注：iOS9以下通过Url Scheme实现拉起
        </h2>
        <h2><span>5.4 在Xcode里选中Target—Info—URL Types, 配置shareInstall为当前应用生成的Url Scheme,如图所示：</span></h2>
        <img src="./img/copywriting/ios3.jpg" alt="">
        <h2><span>5.5 URL Scheme相关代码配置</span></h2>
        <h2>注意：当需要在shareInstall这个方法中处理第三方回调的时候（比如支付宝、微信回调等），请注意区分</h2>
        <pre style="width:800px;height:650px">
<code style="width: 100%;height: 90%;" class="lang-javascript">
//ios9以下 URI Scheme
-(BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation{

    //判断是否通过ShareInstall URL Scheme 唤起App
    if ([SHSmartInstallSDK handLinkURL:url]) {
         return YES;
    }else{
        //其他代码
        return YES;
    }

    return YES;
}

//iOS9以上 URL Scheme
- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(nonnull NSDictionary *)options
{
    //判断是否通过ShareInstall URL Scheme 唤起App
    if ([SHSmartInstallSDK handLinkURL:url]) {

        return YES;
    }else{
        //其他代码
        return YES;
    }

    return YES;
}
</code>
</pre>
        <h2><span>5.6获取唤醒参数，直达具体页</span></h2>
        <h2>通过在url中附带具体的参数，唤醒app并跳转到具体页</h2>
        <pre style="width:800px;height:180px">
<code style="width: 100%;height: 90%;" class="lang-javascript">
- (void)getWakeUpParamsFromSmartInstall: (id) params withError: (NSError *) error{
NSLog(@"唤醒参数params=%@",params);
UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"URL shceme 进来的" message:[self DataTOjsonString:params] delegate:nil cancelButtonTitle:@"取消" otherButtonTitles:@"确定", nil];
//弹出提示框（便于调试，调试完成后删除此代码）
[alert show];
}
</code>
</pre>
        <h2><span>5.6 其他代码配置</span></h2>
        <h2><span>如果做测试，获取参数，则必须在Appdelegate.h加上如下测试代码</span></h2>
        <pre style="width:800px;height:420px">
<code style="width: 100%;height: 90%;" class="lang-javascript">
#pragma mark 将oc数据类型转成NSString
-(NSString *)DataTOjsonString:(id)object
{
    if (!object) {
        return nil;
    }

    NSString *jsonString = nil;
    NSError *error;
    NSData *jsonData = [NSJSONSerialization dataWithJSONObject:object
                                                       options:NSJSONWritingPrettyPrinted
                                                         error:&error];
    if (! jsonData) {
        NSLog(@"Got an error: %@", error);
    } else {
jsonString = [[NSString alloc] initWithData:jsonData encoding:NSUTF8StringEncoding];
    }
    return jsonString;
}
</code>
</pre>
    </div>
    <!--web-->
    <div class="my-web container my-app" style="display: none">
        <h1 style="margin-top: 0;">SDK概述</h1>
        <h2>web sdk用于web页面启动/安装app,并在启动/安装app的同时，向app传递各种自定义参数（通过android/ios sdk可获取传递的参数）。</h2>
        <h2>集成步骤</h2>
        <pre style="width:800px;height:1050px">
<code style="width: 100%;height: 90%;" class="lang-javascript">
&lt;script type="text/javascript" src="ShareInstall.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
    //错误处理：确保app始终能正常的安装
    var timer = setTimeout(
        function() {
            var button = document.getElementById("downloadButton");
            button.style.visibility = "visible";
            button.onclick = function() {
                var ua = navigator.userAgent;
                if (ua.indexOf(" MicroMessenger/") > -1) {
                    //微信中显示遮罩提示在浏览器中打开或进入应用宝
                    var div = document.createElement("div");
                    div.innerHTML = "&lt;div style='font-size:2rem;color:#fff;text-align:center;"
                        +"position:fixed;left:0;top:0;background:rgba(0,0,0,0.5);filter:alpha(opacity=50);"
                        +"width:100%;height:100%;z-index:10000;'&gt;点击右上角在浏览器中打开&lt;/div&gt;";
                    document.body.appendChild(div);
                } else {
                    if (ua.indexOf("Android") > -1) {
                        //直接下载apk
                        //window.location="apk地址";
                    } else if (ua.indexOf("iPhone") > -1 || ua.indexOf("iPad") > -1
                        || ua.indexOf("iPod") > -1) {
                        //直接进入appstore
                        //window.location="appstore地址";
                    }
                }
            }
        }, 5000);

    //shareinstall初始化，初始化时将与shareinstall服务器交互，应尽可能早的调用
    /*web页面向app传递的json数据(json string/js Object)，应用被拉起或是首次安装时，通过相应的
     android/ios api可以获取此数据*/
    var data = ShareInstall.parseUrlParams();//shareinstall.js中提供的工具函数，解析url中的所有查询参数
    new ShareInstall({
        apptypeid : "shareinstall为当前应用分配的apptypeid",
        onready : function() {
            //openinstall已成功回调，清除定时器
            clearTimeout(timer);
            timer = null;

            var m = this, button = document.getElementById("downloadButton");
            button.style.visibility = "visible";

            /*用户点击某个按钮时(假定按钮id为downloadButton)，安装app*/
            button.onclick = function() {
                m.wakeupOrInstall();
            }
        }
    }, data);
&lt;/script&gt;
</code>
</pre>
    </div>
</div>

<!--底部-->
<div class="my-footer">
    <div class="footer container ">
        <div class="top clearfix">
            <a href="./index.html">
                <span class="logo fl"></span>
            </a>

            <!--<div class="kaifazhe fl">-->
            <!--<h5>开发者</h5>-->
            <!--<a href="">SDK下载</a>-->
            <!--<br/>-->
            <!--<a href="">开发文档</a>-->
            <!--</div>-->
            <div class="wendangzhongxin fl">
                <h5>文档中心</h5>
                <a href="./copywriting.html">iOS SDK集成</a>
                <br/>
                <a href="./copywriting.html">Andraid SDK集成</a>
                <br/>
                <a href="./copywriting.html">Web SDK集成</a>
            </div>
            <div class="lianxiwomen fl">
                <h5>联系我们</h5>
                <span>业务咨询QQ：2881355608</span>
                <br/>
                <span>服务热线：17321404310</span>
                <br/>
                <span>服务邮箱：shareinstall@021.com</span>
            </div>
            <!--<div class="qitalianxifangshi fr">-->
            <!--<h5>其他联系方式</h5>-->
            <!--<a href="" class="img imgqq"></a>-->
            <!--<a href="" class="img imgwc"></a>-->
            <!--<a href="" class="img imgpy"></a>-->
            <!--<a href="" class="img imgwb"></a>-->
            <!--</div>-->
            <div class="qitalianxifangshi fr">
                <h5>友情链接</h5>
                <a href="http://mini.eastday.com/" target="_blank" class="footer-a">东方头条</a>
                <a href="http://www.mop.com/" target="_blank" class="footer-a">猫扑</a>
                <a href="http://www.wnwb.com/" target="_blank" class="footer-a">万能五笔输入法</a>
                <br>
                <a href="http://sports.mop.com/" target="_blank" class="footer-a">猫扑体育</a>
                <a href="http://www.znyshurufa.com/zhuomian/index.html" target="_blank" class="footer-a">布丁桌面</a>
                <a href="http://www.znshuru.com/" target="_blank" class="footer-a">智能输入法</a>
                <br>
                <a href="http://sports.eastday.com/" target="_blank" class="footer-a">东方体育</a>
                <a href="http://shurufa.eastday.com/" target="_blank" class="footer-a">东方输入法</a>
                <a href="http://www.wn51.com/kantu/" target="_blank" class="footer-a">万能看图王</a>
                <!--<a href="" class="img imgwc"></a>-->
                <!--<a href="" class="img imgpy"></a>-->
                <!--<a href="" class="img imgwb"></a>-->
            </div>
        </div>
        <div class="bottom ">
            <div class="left " style="text-align: center">
                上海嵩恒网络科技有限公司 版权所有&nbsp;&nbsp;&nbsp;&nbsp;沪ICP备17050836号
            </div>
            <!--<div class="right fr">-->
            <!--<a href="">关于shareinstall</a>&nbsp;&nbsp;&nbsp;&nbsp;-->
            <!--<a href="">服务条款</a>&nbsp;&nbsp;&nbsp;&nbsp;-->
            <!--<a href="">隐私政策</a>-->
            <!--</div>-->
        </div>
    </div>
</div>
<!--谈话框-->
<div id="J_functionBar" class="functionBar">
    <div class="bar-qq">
        <a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=532814151&site=qq&menu=yes" class="icon icon1"
           title="点击这里给我发消息">

        </a>
        联系
    </div>
    <!--<div class="bar-code">-->
    <!--<span class="icon icon2">-->

    <!--</span>-->
    <!--关注-->
    <!--</div>-->
    <div class="bar-back" id="J_barBack">
        返&nbsp;回<br/>
        顶&nbsp;部
    </div>
</div>
<script src="./js/common/base.min.js"></script>
<script src="./js/page/copywriting.min.js"></script>
</body>

</html>